# Opencode 作業フロー

Opencode内で完結する開発フロー。

## コマンド一覧

### Speckit系（仕様・計画・タスク）

| コマンド | 用途 |
|----------|------|
| `/speckit.specify` | 仕様作成（spec.md生成） |
| `/speckit.plan` | 技術計画作成（plan.md生成） |
| `/speckit.tasks` | タスク分解（tasks.md生成） |
| `/speckit.implement` | 実装実行 |
| `/speckit.clarify` | 仕様の明確化 |
| `/speckit.analyze` | 整合性分析 |
| `/speckit.checklist` | チェックリスト作成 |

### レビュー系（ペルソナレビュー）

| コマンド | 用途 | ペルソナ |
|----------|------|----------|
| `/review-plan` | 計画レビュー | PM・リスク・価値・批判 |
| `/review-tasks` | タスク分解レビュー | テックリード・シニア・DevOps・ジュニア |
| `/review-architecture` | 設計レビュー | アーキテクト・セキュリティ・性能・運用 |
| `/review-quality` | 品質レビュー | QA・テスト設計・コード・セキュリティ |
| `/review-phase` | フェーズ完了レビュー | 品質保証・リグレッション・文書化・UX |

### 実装・品質系

| コマンド | 用途 |
|----------|------|
| `/swarm` | 並列エージェント実行（SwarmTools） |
| `/finish` | 品質ゲート（cargo clippy + cargo test） |

## 標準フロー

```
┌─────────────────────────────────────────────────────────────┐
│ 1. 仕様作成                                                  │
│    /speckit.specify "リソースネットワーク機能を追加"         │
│    → spec.md 生成                                           │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ 2. 技術計画                                                  │
│    /speckit.plan                                            │
│    → plan.md 生成                                           │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ 3. 計画レビュー                                              │
│    /review-plan plan.md                                     │
│    → GO / CONDITIONAL / NO-GO                               │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ 4. タスク分解                                                │
│    /speckit.tasks                                           │
│    → tasks.md / tasks/phase0.md 生成                        │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ 5. タスクレビュー                                            │
│    /review-tasks tasks.md                                   │
│    → 依存関係・並列化可能性の確認                            │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ 6. 設計レビュー（必要時）                                    │
│    /review-architecture phase0.md                           │
│    → SOLID・拡張性・セキュリティ確認                         │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ 7. 実装                                                      │
│    /speckit.implement  または  /swarm "phase0を実装"        │
│    → swarm-planner → swarm-worker × N                       │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ 8. 品質ゲート                                                │
│    /finish                                                  │
│    → cargo clippy + cargo test                              │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ 9. 品質レビュー                                              │
│    /review-quality                                          │
│    → テスト網羅性・コード品質確認                            │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ 10. フェーズ完了レビュー                                     │
│     /review-phase phase0                                    │
│     → Definition of Done確認                                │
└─────────────────────────────────────────────────────────────┘
```

## クイックリファレンス

| フェーズ | コマンド |
|----------|----------|
| 仕様 | `/speckit.specify` |
| 計画 | `/speckit.plan` → `/review-plan` |
| タスク | `/speckit.tasks` → `/review-tasks` |
| 設計 | `/review-architecture` |
| 実装 | `/speckit.implement` or `/swarm` |
| 品質 | `/finish` → `/review-quality` |
| 完了 | `/review-phase` |

## SwarmTools仕様準拠ルール

### swarm-plannerの役割

1. 仕様ファイルから正確な型名・シグネチャを抽出
2. subtask descriptionに「EXACT SPEC」を含める
3. 「FORBIDDEN」セクションで禁止事項を明示

### swarm-workerの役割

1. EXACT SPECがあれば**そのまま実装**
2. 命名・型・可視性の変更禁止
3. 仕様に疑問があればblockしてcoordinator確認

### 禁止事項（FORBIDDEN）

- 命名変更（PortSide → MachinePortSide）
- 型変更（u8 → usize）
- 可視性変更（pub → private）
- 仕様にない機能追加
- 「改善」のための変更

## 品質ゲート

`/finish` 実行時に自動チェック:

1. `cargo clippy -- -D warnings` - 警告なし
2. `cargo test` - 全テストパス

失敗したら修正してから再実行。
