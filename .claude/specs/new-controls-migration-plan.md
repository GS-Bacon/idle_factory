# æ–°æ“ä½œä»•æ§˜ ç§»è¡Œè¨ˆç”» v2

## å¤‰æ›´å±¥æ­´
- v2: ã‚»ãƒ«ãƒ•ãƒ¬ãƒ“ãƒ¥ãƒ¼åæ˜ ã€Bevy 0.18å¯¾å¿œã€PlatformInventoryå»ƒæ­¢
- v2.1: æœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼åæ˜ ã€Modding APIå¯¾å¿œã€ãƒ‘ãƒ¬ãƒƒãƒˆUIè©³ç´°ã€Phaseåˆ†å‰²

---

## è¨­è¨ˆæ–¹é‡ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼åæ˜ ï¼‰

### ãƒã‚¤ãƒ³ãƒˆçµŒæ¸ˆ
- **å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–**: `assets/data/economy.toml` ã§èª¿æ•´å¯èƒ½ã«
- **è©°ã¿é˜²æ­¢**: ãƒ–ãƒ­ãƒƒã‚¯ç ´å£Šæ™‚ã«ã‚‚ãƒã‚¤ãƒ³ãƒˆå–å¾—ï¼ˆè¨­ç½®ã‚³ã‚¹ãƒˆã®50%ç­‰ï¼‰
- **ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ã¯å¾Œå›ã—**: éŠã³ãªãŒã‚‰èª¿æ•´

### ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ 
- **è¤‡æ•°ã‚¯ã‚¨ã‚¹ãƒˆ**: å—æ³¨é †ã«å„ªå…ˆã—ã¦åŸ‹ã¾ã‚‹
- **è©³ç´°è¨­è¨ˆã¯å¾Œå›ã—**: åŸºæœ¬å‹•ä½œã‚’å…ˆã«å®Ÿè£…

### è¨­ç½®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆã‚´ãƒ¼ã‚¹ãƒˆï¼‰
- **ç¶­æŒ**: ç¾çŠ¶ã®è¨­ç½®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã¯ãã®ã¾ã¾ç¶­æŒ

---

## Phase 0: Bevy 0.15 â†’ 0.18 ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ˆå…ˆè¡Œå®Ÿæ–½ï¼‰

### ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ç†ç”±

ç¾åœ¨ Bevy 0.15 ã‚’ä½¿ç”¨ã€‚0.18 ã§åˆ©ç”¨å¯èƒ½ãªæ–°æ©Ÿèƒ½ã«ã‚ˆã‚Šå®Ÿè£…ã‚’ç°¡ç•¥åŒ–ã§ãã‚‹ã€‚

### Bevy 0.16 ã®æ–°æ©Ÿèƒ½ï¼ˆæ´»ç”¨å¯èƒ½ï¼‰

| æ©Ÿèƒ½ | æ´»ç”¨æ–¹æ³• |
|------|----------|
| **ECS Relationships** | è¦ªå­é–¢ä¿‚ã®æ”¹å–„ã€ChildOf/Children |
| **Entity Disabling** | UIè¡¨ç¤º/éè¡¨ç¤ºã‚’Visibilityã‹ã‚‰ç§»è¡Œå¯èƒ½ |
| **Improved Spawn API** | `children!`ãƒã‚¯ãƒ­ã§UIç”Ÿæˆç°¡ç•¥åŒ– |
| **Required Components** | MachineBundleç­‰ã®ãƒãƒ³ãƒ‰ãƒ«ç°¡ç•¥åŒ– |

### Bevy 0.17 ã®æ–°æ©Ÿèƒ½ï¼ˆæ´»ç”¨å¯èƒ½ï¼‰

| æ©Ÿèƒ½ | æ´»ç”¨æ–¹æ³• |
|------|----------|
| **CursorOptions åˆ†é›¢** | Window ã‹ã‚‰åˆ†é›¢ï¼ˆå»ƒæ­¢ã™ã‚‹ã®ã§å½±éŸ¿å°ï¼‰ |
| **Headless UI Widgets** | ãƒ‘ãƒ¬ãƒƒãƒˆUIã®ãƒ™ãƒ¼ã‚¹ |
| **Event â†’ Message åˆ†é›¢** | ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ æ”¹å–„ |

### Bevy 0.18 ã®æ–°æ©Ÿèƒ½ï¼ˆæ´»ç”¨å¯èƒ½ï¼‰

| æ©Ÿèƒ½ | æ´»ç”¨æ–¹æ³• |
|------|----------|
| **First-Party Camera Controllers** | è‡ªå‰flyã‚«ãƒ¡ãƒ©ã‚’ç½®ãæ›ãˆå¯èƒ½ã‹è¦æ¤œè¨¼ |
| **Standard UI Widgets** | ãƒœã‚¿ãƒ³ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ç­‰ |
| **Popover Component** | ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ |
| **Font Variations** | ãƒ•ã‚©ãƒ³ãƒˆæ©Ÿèƒ½æ”¹å–„ |

### ç ´å£Šçš„å¤‰æ›´ã¸ã®å¯¾å¿œ

| å¤‰æ›´ | å¯¾å¿œ |
|------|------|
| `Window.cursor_options` â†’ `CursorOptions` Component | ã‚«ãƒ¼ã‚½ãƒ«å‡¦ç†ã‚’æ›´æ–° |
| `Pointer<Pressed>` â†’ `Pointer<Press>` | ã‚¤ãƒ™ãƒ³ãƒˆåå¤‰æ›´ |
| `Event` â†’ `Message` (buffered events) | å¿…è¦ã«å¿œã˜ã¦ç§»è¡Œ |

### ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆäº’æ›æ€§

bevyä»¥å¤–ã®ã‚¯ãƒ¬ãƒ¼ãƒˆï¼ˆwasmtime, tokio, serdeç­‰ï¼‰ã¯Bevyãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ä¾å­˜ã—ãªã„ãŸã‚å•é¡Œãªã—ã€‚

---

## ç¾çŠ¶ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã®æ•´åˆæ€§åˆ†æ

### å»ƒæ­¢å¯¾è±¡ã¨é–¢é€£ã‚³ãƒ¼ãƒ‰

| æ©Ÿèƒ½ | é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ« | å½±éŸ¿ç¯„å›² |
|------|-------------|----------|
| **PlayerInventory** | `src/player/inventory.rs` | æ‰‹æŒã¡ã‚¢ã‚¤ãƒ†ãƒ ç®¡ç† |
| **PlatformInventory** | `src/player/platform_inventory.rs` | **å»ƒæ­¢**ï¼ˆåˆ°é”å³ãƒã‚¤ãƒ³ãƒˆåŒ–ï¼‰ |
| **ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªUI** | `src/systems/inventory_ui/*.rs` (7ãƒ•ã‚¡ã‚¤ãƒ«) | ã‚¹ãƒ­ãƒƒãƒˆè¡¨ç¤ºãƒ»æ“ä½œ |
| **ãƒ›ãƒƒãƒˆãƒãƒ¼** | `src/systems/hotbar.rs`, `src/setup/ui/inventory_ui.rs` | 1-9ã‚­ãƒ¼é¸æŠ |
| **ã‚«ãƒ¼ã‚½ãƒ«ãƒ­ãƒƒã‚¯** | `src/systems/cursor.rs`, `src/systems/player.rs` | FPSæ“ä½œ |
| **ã‚µãƒã‚¤ãƒãƒ«ç§»å‹•** | `src/systems/player.rs` (survival_movement) | è¡çªãƒ»é‡åŠ› |
| **ç ´å£Šæ™‚é–“** | `src/systems/block_operations/breaking.rs` | é€²æ—ãƒãƒ¼ |
| **æ‰‹å‹•ç´å“** | `src/systems/quest.rs` (quest_deliver_button) | ç´å“ãƒœã‚¿ãƒ³ |

### Modding API å¤‰æ›´ï¼ˆèª¿æŸ»çµæœï¼‰

| ãƒ•ã‚¡ã‚¤ãƒ« | ç¾çŠ¶ | å¯¾å¿œ |
|----------|------|------|
| `src/modding/wasm/api/inventory.rs` | stubå®Ÿè£… | **å‰Šé™¤** |
| `src/modding/server/message_handler.rs` | `PlayerInventory`å‚ç…§ã€hotbarè¿”å´ | **PlacementModeå‚ç…§ã«å¤‰æ›´** |
| `src/modding/server/ui_state.rs` | `UIContext::Inventory`, `InventoryOpen` | **å‰Šé™¤** |
| `src/modding/handlers/test.rs` | Inventoryé–¢é€£ãƒ†ã‚¹ãƒˆ | **æ›´æ–°** |

### ç¶­æŒå¯¾è±¡

| æ©Ÿèƒ½ | é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´ç‚¹ |
|------|-------------|--------|
| **LocalPlayer** | `src/player/inventory.rs` | **ç¶­æŒ**ï¼ˆã‚«ãƒ¡ãƒ©ãƒ»ç§»å‹•ã§ä½¿ç”¨ï¼‰ |
| **ã‚³ãƒ³ãƒ™ã‚¢ã‚·ã‚¹ãƒ†ãƒ ** | `src/logistics/conveyor.rs` | åˆ°é”æ™‚ã«å³ãƒã‚¤ãƒ³ãƒˆåŒ– |
| **æ©Ÿæ¢°ã‚·ã‚¹ãƒ†ãƒ ** | `src/machines/generic/*.rs` | ã‚¯ãƒªãƒƒã‚¯ã§UIè¡¨ç¤ºï¼ˆç¶­æŒï¼‰ |
| **ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ** | `src/systems/quest.rs` | è‡ªå‹•å®Œäº†ã«å¤‰æ›´ |
| **è¨­ç½®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼** | `src/systems/targeting/*.rs` | **ç¶­æŒ** |

### è¿½åŠ ã§å¤‰æ›´ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ |
|----------|----------|
| `src/save/format/*.rs` | ã‚»ãƒ¼ãƒ–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›´ï¼ˆInventoryå‰Šé™¤ï¼‰ |
| `src/setup/initial_items.rs` | åˆæœŸãƒã‚¤ãƒ³ãƒˆè¨­å®šã«å¤‰æ›´ |
| `src/systems/tutorial.rs` | ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å…¨é¢æ›´æ–° |
| `src/components/ui.rs` | `UIContext::Inventory` å‰Šé™¤ |
| `tests/e2e_test.rs` | ãƒ†ã‚¹ãƒˆæ›´æ–° |

### æ–°è¦è¿½åŠ 

| æ©Ÿèƒ½ | æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ« | æ¦‚è¦ |
|------|-------------|------|
| **BuildingPoints** | `src/core/points.rs` | ãƒã‚¤ãƒ³ãƒˆãƒªã‚½ãƒ¼ã‚¹ |
| **PlacementMode** | `src/systems/placement_mode.rs` | ã‚«ãƒ†ã‚´ãƒªãƒ»é¸æŠçŠ¶æ…‹ |
| **ãƒ‘ãƒ¬ãƒƒãƒˆUI** | `src/setup/ui/palette_ui.rs` | ç”»é¢ä¸‹éƒ¨UI |
| **çµŒæ¸ˆãƒ‡ãƒ¼ã‚¿** | `assets/data/economy.toml` | ãƒã‚¤ãƒ³ãƒˆè¨­å®šï¼ˆå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ |

---

## å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«è¨­è¨ˆ

### `assets/data/economy.toml`

```toml
[points]
initial = 100

[placement_costs]
# ç‰©æµ
conveyor = 0        # ç„¡æ–™ï¼ˆè©°ã¿é˜²æ­¢ï¼‰
splitter = 2
merger = 2

# ç”Ÿç”£
miner = 5
furnace = 10
crusher = 8

# é›»åŠ›ï¼ˆå°†æ¥ï¼‰
# power_wire = 4
# generator = 15

[item_values]
# åŸæ–™
stone = 1
coal = 2
iron_ore = 3
copper_ore = 3

# ä¸€æ¬¡åŠ å·¥å“
iron_ingot = 6
copper_ingot = 6

# äºŒæ¬¡åŠ å·¥å“
iron_plate = 12

[refund]
# æ’¤å»æ™‚ã®è¿”é‚„ç‡ï¼ˆ0.0-1.0ï¼‰
rate = 1.0  # 100%è¿”é‚„

[breaking]
# ãƒ–ãƒ­ãƒƒã‚¯ç ´å£Šæ™‚ã®ãƒã‚¤ãƒ³ãƒˆå–å¾—ï¼ˆè©°ã¿é˜²æ­¢ï¼‰
# è¨­ç½®ã‚³ã‚¹ãƒˆã®ä½•%ã‚’å–å¾—ã™ã‚‹ã‹
rate = 0.5  # 50%

[quest_rewards]
# ã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†å ±é…¬ï¼ˆã‚¯ã‚¨ã‚¹ãƒˆIDã”ã¨ã«è¨­å®šå¯èƒ½ï¼‰
default_multiplier = 1.0
```

---

## ãƒ‘ãƒ¬ãƒƒãƒˆUI è©³ç´°è¨­è¨ˆ

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [K] ç‰©æµ   [P] ç”Ÿç”£   [L] é›»åŠ›   [B] å»ºç¯‰                     â”‚  â† ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ï¼ˆé¸æŠä¸­ã¯ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”â”‚
â”‚ â”‚ 1  â”‚ â”‚ 2  â”‚ â”‚ 3  â”‚ â”‚ 4  â”‚ â”‚ 5  â”‚ â”‚ 6  â”‚ â”‚ 7  â”‚ â”‚ 8  â”‚ â”‚ 9  â”‚â”‚  â† æ•°å­—ã‚­ãƒ¼
â”‚ â”‚iconâ”‚ â”‚iconâ”‚ â”‚iconâ”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚â”‚  â† ã‚¢ã‚¤ã‚³ãƒ³
â”‚ â”‚ 0p â”‚ â”‚ 2p â”‚ â”‚ 2p â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚â”‚  â† ã‚³ã‚¹ãƒˆ
â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜â”‚
â”‚  â–²é¸æŠä¸­                                           ğŸ’° 1,250 pt â”‚  â† ãƒã‚¤ãƒ³ãƒˆæ®‹é«˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³

| æ“ä½œ | å‹•ä½œ |
|------|------|
| ã‚«ãƒ†ã‚´ãƒªã‚­ãƒ¼ (K/P/L/B) | ã‚«ãƒ†ã‚´ãƒªåˆ‡æ›¿ã€é¸æŠã‚’1ã«ãƒªã‚»ãƒƒãƒˆ |
| æ•°å­—ã‚­ãƒ¼ (1-9) | ã‚¢ã‚¤ãƒ†ãƒ é¸æŠ |
| ã‚¹ãƒ­ãƒƒãƒˆã‚¯ãƒªãƒƒã‚¯ | ã‚¢ã‚¤ãƒ†ãƒ é¸æŠ |
| ã‚¹ãƒ­ãƒƒãƒˆãƒ›ãƒãƒ¼ | ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºï¼ˆã‚¢ã‚¤ãƒ†ãƒ åã€èª¬æ˜ã€ã‚³ã‚¹ãƒˆï¼‰ |
| ãƒã‚¤ãƒ³ãƒˆä¸è¶³æ™‚ | ã‚¹ãƒ­ãƒƒãƒˆã‚’ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã€ã‚¯ãƒªãƒƒã‚¯ä¸å¯ |

### é¸æŠçŠ¶æ…‹ã®è¡¨ç¤º

- **é¸æŠä¸­**: æ ç·šã‚’æ˜ã‚‹ãã€èƒŒæ™¯ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- **ãƒ›ãƒãƒ¼ä¸­**: èƒŒæ™¯ã‚’è–„ããƒã‚¤ãƒ©ã‚¤ãƒˆ
- **ãƒã‚¤ãƒ³ãƒˆä¸è¶³**: ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã€ã‚¢ã‚¤ã‚³ãƒ³ã‚’åŠé€æ˜

### ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆBevy 0.18 Popoveræ´»ç”¨ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚³ãƒ³ãƒ™ã‚¢         â”‚  â† ã‚¢ã‚¤ãƒ†ãƒ å
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ã‚¢ã‚¤ãƒ†ãƒ ã‚’é‹æ¬  â”‚  â† èª¬æ˜
â”‚ ã‚³ã‚¹ãƒˆ: 0pt     â”‚  â† ã‚³ã‚¹ãƒˆï¼ˆç„¡æ–™ãªã‚‰ã€Œç„¡æ–™ã€ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è©³ç´°ç§»è¡Œãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå¾ªç’°ä¾å­˜è§£æ¶ˆç‰ˆï¼‰

### Phase 0: Bevy 0.18 ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

ï¼ˆå‰è¿°ã®é€šã‚Šï¼‰

### Phase 1: æ“ä½œç³»å¤‰æ›´

#### 1.1 ã‚«ãƒ¼ã‚½ãƒ«å¸¸æ™‚è¡¨ç¤ºåŒ–
#### 1.2 ä¸­ãƒœã‚¿ãƒ³ãƒ‰ãƒ©ãƒƒã‚°ã§è¦–ç‚¹å›è»¢
#### 1.3 ã‚µãƒã‚¤ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰å‰Šé™¤

ï¼ˆè©³ç´°ã¯å‰å›è¨ˆç”»ã®é€šã‚Šï¼‰

---

### Phase 2: ãƒ–ãƒ­ãƒƒã‚¯æ“ä½œå¤‰æ›´

#### 2.1 å³æ™‚æ’¤å»
#### 2.2 å·¦=æ’¤å»ã€å³=è¨­ç½®
#### 2.3 æ’¤å»æ™‚ãƒã‚¤ãƒ³ãƒˆå–å¾—ï¼ˆè©°ã¿é˜²æ­¢ï¼‰

```rust
pub fn block_break(..., mut points: ResMut<BuildingPoints>) {
    // ...æ’¤å»å‡¦ç†...

    // ãƒã‚¤ãƒ³ãƒˆå–å¾—ï¼ˆè¨­ç½®ã‚³ã‚¹ãƒˆã®50%ï¼‰
    let cost = get_placement_cost(item_id);
    let refund = (cost as f32 * economy.breaking.rate) as u32;
    points.add(refund);
}
```

---

### Phase 3a: PlacementMode ãƒªã‚½ãƒ¼ã‚¹ï¼ˆUIç„¡ã—ï¼‰

**ç›®çš„**: Phase 4 ã‚ˆã‚Šå…ˆã«å¿…è¦ãªçŠ¶æ…‹ç®¡ç†ã‚’è¿½åŠ 

```rust
#[derive(Resource, Default)]
pub struct PlacementMode {
    pub category: Category,
    pub selected_index: usize,
}

#[derive(Default, Clone, Copy, PartialEq, Eq)]
pub enum Category {
    #[default]
    Logistics,
    Production,
    Power,
    Building,
}
```

---

### Phase 4a: BuildingPoints ãƒªã‚½ãƒ¼ã‚¹ï¼ˆæ¶ˆè²»ãªã—ï¼‰

**ç›®çš„**: Phase 3b ã‚ˆã‚Šå…ˆã«å¿…è¦ãªçŠ¶æ…‹ç®¡ç†ã‚’è¿½åŠ 

```rust
#[derive(Resource)]
pub struct BuildingPoints {
    pub current: u32,
}
```

---

### Phase 3b: ãƒ‘ãƒ¬ãƒƒãƒˆUI

**ç›®çš„**: ãƒ‘ãƒ¬ãƒƒãƒˆUIã‚’å®Ÿè£…ï¼ˆã‚³ã‚¹ãƒˆè¡¨ç¤ºå«ã‚€ï¼‰

- ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–
- ã‚¢ã‚¤ãƒ†ãƒ ã‚¹ãƒ­ãƒƒãƒˆï¼ˆã‚¢ã‚¤ã‚³ãƒ³ + ã‚³ã‚¹ãƒˆï¼‰
- ãƒã‚¤ãƒ³ãƒˆæ®‹é«˜è¡¨ç¤º
- ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
- é¸æŠçŠ¶æ…‹ã®è¡¨ç¤º
- ãƒã‚¤ãƒ³ãƒˆä¸è¶³æ™‚ã®ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ

---

### Phase 4b: ãƒã‚¤ãƒ³ãƒˆæ¶ˆè²»ãƒ»è¿”é‚„

**ç›®çš„**: è¨­ç½®æ™‚æ¶ˆè²»ã€æ’¤å»æ™‚è¿”é‚„

```rust
// è¨­ç½®æ™‚
let cost = get_placement_cost(selected_item_id);
if !points.try_consume(cost) {
    return; // ãƒã‚¤ãƒ³ãƒˆä¸è¶³
}

// æ’¤å»æ™‚
let cost = get_placement_cost(item_id);
let refund = (cost as f32 * economy.refund.rate) as u32;
points.add(refund);
```

---

### Phase 5: è‡ªå‹•ç´å“ï¼ˆPlatformInventoryå»ƒæ­¢ï¼‰

#### 5.1 conveyor_transfer æ”¹ä¿®

```rust
TransferTarget::Delivery => {
    // å³åº§ã«ãƒã‚¤ãƒ³ãƒˆåŒ–
    let point_value = economy.get_item_value(item.item_id);
    points.add(point_value);

    // ã‚¯ã‚¨ã‚¹ãƒˆé€²æ—æ›´æ–°
    quest_progress.record_delivery(item.item_id, 1);

    // ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«å‰Šé™¤
    // ...
}
```

#### 5.2 PlatformInventory å‰Šé™¤

---

### Phase 6: æ—¢å­˜æ©Ÿèƒ½å‰Šé™¤

#### 6.1 å‰Šé™¤å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

```
src/player/inventory.rs              # PlayerInventoryï¼ˆLocalPlayerã¯åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ç§»å‹•ï¼‰
src/player/platform_inventory.rs     # PlatformInventory
src/systems/inventory_ui/            # å…¨7ãƒ•ã‚¡ã‚¤ãƒ«
src/systems/hotbar.rs                # ãƒ›ãƒƒãƒˆãƒãƒ¼
src/setup/ui/inventory_ui.rs         # ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªUIã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
src/modding/wasm/api/inventory.rs    # WASM APIï¼ˆstubï¼‰
```

#### 6.2 Modding API æ›´æ–°

**WebSocket API** (`src/modding/server/message_handler.rs`):

```rust
// æ—§: player_query: Query<(&Transform, &PlayerInventory)>
// æ–°: player_query: Query<&Transform, With<Player>>

// æ—§: hotbaræƒ…å ±ã‚’è¿”ã™
// æ–°: ãƒ‘ãƒ¬ãƒƒãƒˆæƒ…å ±ã‚’è¿”ã™
let palette_state = PaletteStateInfo {
    category: placement_mode.category.to_string(),
    selected_index: placement_mode.selected_index,
    points: points.current,
};
```

#### 6.3 UIContext æ›´æ–°

```rust
pub enum UIContext {
    Gameplay,
    PauseMenu,
    Settings,
    Quest,
    // Inventory, â† å‰Šé™¤
    MachineUI(Entity),
}
```

---

## ç§»è¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 0 å®Œäº†æ¡ä»¶
- [ ] `bevy = "0.18"` ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æˆåŠŸ
- [ ] CursorOptions å¯¾å¿œå®Œäº†
- [ ] å…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹

### Phase 1 å®Œäº†æ¡ä»¶
- [ ] ã‚«ãƒ¼ã‚½ãƒ«ãŒå¸¸æ™‚è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ä¸­ãƒœã‚¿ãƒ³ãƒ‰ãƒ©ãƒƒã‚°ã§è¦–ç‚¹å›è»¢ã™ã‚‹
- [ ] Alt+å·¦ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚‚è¦–ç‚¹å›è»¢ã™ã‚‹
- [ ] è¡çªåˆ¤å®šãªã—ã§ç§»å‹•ã§ãã‚‹

### Phase 2 å®Œäº†æ¡ä»¶
- [ ] å·¦ã‚¯ãƒªãƒƒã‚¯ã§å³åº§ã«æ’¤å»ã§ãã‚‹
- [ ] å³ã‚¯ãƒªãƒƒã‚¯ã§å³åº§ã«è¨­ç½®ã§ãã‚‹
- [ ] æ’¤å»æ™‚ã«ãƒã‚¤ãƒ³ãƒˆã‚’å–å¾—ã§ãã‚‹

### Phase 3a/4a å®Œäº†æ¡ä»¶
- [ ] PlacementMode ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã™ã‚‹
- [ ] BuildingPoints ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã™ã‚‹
- [ ] ã‚«ãƒ†ã‚´ãƒªã‚­ãƒ¼ã§åˆ‡æ›¿ã§ãã‚‹

### Phase 3b å®Œäº†æ¡ä»¶
- [ ] ãƒ‘ãƒ¬ãƒƒãƒˆUIãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚³ã‚¹ãƒˆè¡¨ç¤ºãŒã‚ã‚‹
- [ ] ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒã‚¤ãƒ³ãƒˆä¸è¶³æ™‚ã«ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã™ã‚‹

### Phase 4b å®Œäº†æ¡ä»¶
- [ ] è¨­ç½®æ™‚ã«ãƒã‚¤ãƒ³ãƒˆãŒæ¶ˆè²»ã•ã‚Œã‚‹
- [ ] æ’¤å»æ™‚ã«ãƒã‚¤ãƒ³ãƒˆãŒè¿”é‚„ã•ã‚Œã‚‹
- [ ] ã‚³ãƒ³ãƒ™ã‚¢ãŒç„¡æ–™ã§è¨­ç½®ã§ãã‚‹

### Phase 5 å®Œäº†æ¡ä»¶
- [ ] åˆ°é”æ™‚ã«å³ãƒã‚¤ãƒ³ãƒˆåŒ–ã•ã‚Œã‚‹
- [ ] PlatformInventory å‚ç…§ãŒ0ä»¶

### Phase 6 å®Œäº†æ¡ä»¶
- [ ] PlayerInventoryé–¢é€£ã‚³ãƒ¼ãƒ‰ãŒ0è¡Œ
- [ ] Modding APIãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹
- [ ] å…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹

---

## æ¨å¥¨å®Ÿè£…é †åº

```
Phase 0 (Bevy 0.18)
    â†“
Phase 1 (æ“ä½œç³»)
    â†“
Phase 2 (ãƒ–ãƒ­ãƒƒã‚¯æ“ä½œ)
    â†“
Phase 3a (PlacementMode) + Phase 4a (BuildingPoints) â† ä¸¦è¡Œå¯èƒ½
    â†“
Phase 3b (ãƒ‘ãƒ¬ãƒƒãƒˆUI) + Phase 4b (ãƒã‚¤ãƒ³ãƒˆæ¶ˆè²») â† ä¸¦è¡Œå¯èƒ½
    â†“
Phase 5 (è‡ªå‹•ç´å“ãƒ»PlatformInventoryå»ƒæ­¢)
    â†“
Phase 6 (å‰Šé™¤)
```

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [Bevy 0.16 Release Notes](https://bevy.org/news/bevy-0-16/)
- [Bevy 0.17 Release Notes](https://bevy.org/news/bevy-0-17/)
- [Bevy 0.18 Release Notes](https://bevy.org/news/bevy-0-18/)
- [Bevy 0.15 to 0.16 Migration](https://bevy.org/learn/migration-guides/0-15-to-0-16/)
- [Bevy 0.16 to 0.17 Migration](https://bevy.org/learn/migration-guides/0-16-to-0-17/)
