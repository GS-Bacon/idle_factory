name = "バグ再現: 無限壁登り"
description = "壁に向かってジャンプを繰り返しても登れないことを確認"

# UIをGameplayにリセット
[[steps]]
action = "set_ui_state"
params = { state = "Gameplay" }

[[steps]]
action = "wait"
params = { ms = 200 }

# テスト用の位置にテレポート（地面レベル y=10）
[[steps]]
action = "command"
params = { command = "tp 50 11 50" }

[[steps]]
action = "wait"
params = { ms = 300 }

# 地面ブロックを設置（プレイヤーの足元）
[[steps]]
action = "command"
params = { command = "setblock 50 10 50 stone" }

[[steps]]
action = "command"
params = { command = "setblock 50 10 51 stone" }

[[steps]]
action = "command"
params = { command = "setblock 50 10 52 stone" }

# 正面（Z+方向）に縦3段の壁を作成
[[steps]]
action = "command"
params = { command = "setblock 50 11 53 stone" }

[[steps]]
action = "command"
params = { command = "setblock 50 12 53 stone" }

[[steps]]
action = "command"
params = { command = "setblock 50 13 53 stone" }

[[steps]]
action = "wait"
params = { ms = 300 }

# 初期位置を取得
[[steps]]
action = "get_state"

# 壁に向かって前進開始
[[steps]]
action = "send_input"
params = { action = "MoveForward", held = true }

# ジャンプを連打（壁登り試行）
[[steps]]
action = "send_input"
params = { action = "Jump" }

[[steps]]
action = "wait"
params = { ms = 250 }

[[steps]]
action = "send_input"
params = { action = "Jump" }

[[steps]]
action = "wait"
params = { ms = 250 }

[[steps]]
action = "send_input"
params = { action = "Jump" }

[[steps]]
action = "wait"
params = { ms = 250 }

[[steps]]
action = "send_input"
params = { action = "Jump" }

[[steps]]
action = "wait"
params = { ms = 250 }

[[steps]]
action = "send_input"
params = { action = "Jump" }

[[steps]]
action = "wait"
params = { ms = 250 }

# 移動停止
[[steps]]
action = "send_input"
params = { action = "MoveForward", held = false }

[[steps]]
action = "wait"
params = { ms = 500 }

# 最終状態を取得
[[steps]]
action = "get_state"

# Y座標が13未満であることを確認（壁登りできていない）
# 初期位置が y=11 なので、壁の上(y=14)に登れていたらバグ
[[steps]]
action = "assert"
params = { condition = "player_y < 13.0" }
