# Factory Data Architect 懸念点レポート

## 概要
コードレビューで発見した懸念点・潜在的なバグをまとめる。

---

## 🔴 高優先度（バグ・クラッシュの可能性）

### 1. レシピID入力のバリデーション不足
**ファイル**: `RecipeEditor.tsx`
**問題**:
- レシピIDがデフォルト`"new_recipe"`のまま保存できてしまう
- 空のレシピIDで保存可能
- 既存レシピIDとの重複チェックがない
- i18n_keyが`recipeId`と同期していない（アイテムエディタでは自動生成される）

**影響**: 同名ファイルの上書き、データ紛失のリスク

**修正案**:
- 空のIDで保存を禁止
- 既存レシピIDとの重複チェック
- i18n_keyを`recipe.{id}`形式で自動生成

---

### 2. アイテム削除がファイルシステムに反映されない
**ファイル**: `App.tsx` (ItemsTab)
**問題**:
- `handleDeleteItem`はUI上のリストから削除するだけ
- 実際の`.ron`ファイルは削除されない
- 次回起動時に削除したはずのアイテムが復活

**影響**: ユーザーの混乱、データの不整合

**修正案**:
- Rustバックエンドに`delete_item_data`コマンドを追加
- ファイル削除時に確認ダイアログを強化

---

### 3. processTimeの型不一致
**ファイル**: `RecipeEditor.tsx` / `recipe.ts` / `recipe.rs`
**問題**:
- TypeScript側: `processTime`は整数として扱われている（`parseInt`）
- 表示: "Process Time (ticks)"と記載
- Rust側: `process_time: f32` (浮動小数点)

**影響**: 小数点の処理時間が設定できない、または設定しても無視される

**修正案**:
- TypeScript側を`parseFloat`に変更
- またはRust側を`u32`に統一

---

## 🟡 中優先度（UX問題・潜在的バグ）

### 4. カタログにfluids/machines/tagsがロードされない
**ファイル**: `lib.rs` (get_assets_catalog)
**問題**:
- `get_assets_catalog`関数はitemsのみをファイルからロード
- fluids, machines, tagsは常に空の配列
- コメントに「Items tab of the editorで定義すべき」とあるが、カテゴリ分けの仕組みがない

**影響**: レシピエディタでfluids/machines/tagsが選択できない

**修正案**:
- ItemDataのcategoryに基づいてfluids/machinesを分類
- またはfluids/machinesを別ディレクトリで管理

---

### 5. アイテム編集時のID変更で不整合
**ファイル**: `ItemEditor.tsx`
**問題**:
- 既存アイテムを編集してIDを変更すると、新しいIDでファイルが保存される
- 古いIDのファイルは残る（ゴミファイル）
- アイテム一覧にも古いIDと新しいIDの両方が表示される可能性

**影響**: データの重複、ファイルシステムの汚染

**修正案**:
- 既存アイテム編集時はID変更を禁止（readonly）
- またはID変更時に古いファイルを削除

---

### 6. ローカライズ保存の部分的失敗
**ファイル**: `ItemEditor.tsx`
**問題**:
- アイテムデータ保存後にローカライズを保存
- ローカライズ保存が失敗してもアイテムは保存済み
- 次回読み込み時にローカライズが空になる可能性

**影響**: ローカライズデータの欠損

**修正案**:
- トランザクション的な保存（両方成功するか、両方失敗するか）
- または保存順序を逆に（ローカライズ→アイテム）

---

## 🟢 低優先度（改善提案）

### 7. レシピエディタのi18n_key手動入力
**ファイル**: `RecipeEditor.tsx`
**問題**:
- i18n_keyが手動入力になっている
- アイテムエディタでは自動生成なのに一貫性がない

**修正案**:
- `recipe.{recipeId}`形式で自動生成

---

### 8. DEFAULT_ASSETS_PATHのハードコード
**ファイル**: `App.tsx`
**問題**:
- ユーザー固有のパスがハードコードされている
- 他の環境では動作しない

**修正案**:
- 環境変数または設定ファイルから読み込み
- または初回起動時に必ず選択させる

---

## 修正優先順

1. **レシピIDバリデーション** - データ紛失リスク
2. **アイテム削除のファイル反映** - データ不整合
3. **既存アイテムのID編集禁止** - ゴミファイル防止
4. **processTimeの型統一** - データ型不整合
5. **i18n_key自動生成（レシピ）** - UX改善
