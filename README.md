# Infinite Voxel Factory

**理想の工場を築き上げる、自動化と建築に特化した3Dボクセルシミュレーションゲーム**

Factorio、Satisfactory、Minecraft (Create Mod) からインスピレーションを得た、敵やサバイバル要素のない純粋な工場建設ゲームです。プレイヤーはジェットパックで自由に飛行し、広大な3D空間で複雑な自動化システムを構築できます。

[![Rust](https://img.shields.io/badge/rust-stable-orange.svg)](https://www.rust-lang.org)
[![Bevy](https://img.shields.io/badge/bevy-0.15-blue.svg)](https://bevyengine.org)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

## 🎮 ゲームの特徴

### コアコンセプト
- **敵なし、サバイバル要素なし** - 純粋な建築と自動化に集中
- **ジェットパック飛行** - 3D空間を自由に移動
- **データ駆動設計** - すべてのコンテンツはYAMLで定義
- **モッディング対応** - 拡張可能なアーキテクチャ
- **マルチプレイヤー対応** - 協力プレイの基盤を実装済み

## 🚀 実装済み機能 (Phase 1-3 完了)

### Phase 1: コアエンジンとモッディング基盤
- ✅ YAMLベースのアセットシステム（ブロック、アイテム、レシピ）
- ✅ ホットリロード対応
- ✅ 動的テクスチャアトラス生成
- ✅ チャンクシステム (32×32×32)
- ✅ グリーディメッシング（voxel rendering最適化）
- ✅ カスタムシェーダーサポート (.wgsl)
- ✅ マルチプレイヤー基盤 (bevy_renet/lightyear)

### Phase 2: ロジスティクスシミュレーション
- ✅ 固定タイムステップ (20 TPS) による決定論的シミュレーション
- ✅ グリッドベース機械配置システム
- ✅ アイテムエンティティ最適化（インスタンス描画で1000+アイテム）
- ✅ インベントリシステム（スタッキング、最大999個）
- ✅ ビジュアルアイテムシステム（コンベア上のアイテム表示）
- ✅ デバッグオーバーレイ (F3キー: FPS、座標、メモリ使用量)

### Phase 3: 電力とマルチブロック
- ✅ 電力ネットワークシステム
  - 回転速度と負荷に基づく運動エネルギー伝達
  - BFSによるネットワークグループ検出
  - 過負荷検出と適切な停止処理
- ✅ マルチブロック構造検証
  - YAMLパターン定義
  - 回転対応の構造マッチング
  - マスター/スレーブコンポーネントシステム
  - 自動整合性チェック
- ✅ 機械操作GUIフレームワーク
  - レシピ選択UI
  - リアルタイムインベントリ表示
  - イベント駆動のステート管理

### Phase 3.5: UI/UXシステム (2025-12-16 完了)
- ✅ **プレイヤーインベントリUI**
  - 装備スロット (5箇所: Head/Chest/Legs/Feet/Tool)
  - メインインベントリ (8×3グリッド、24スロット)
  - ホットバー (9スロット)
  - ドラッグ&ドロップでアイテム移動
  - Minecraft風レイアウト (54×54pxスロット)

- ✅ **クリエイティブモードシステム**
  - デフォルトモードがCreative (テスト段階)
  - アイテムカタログ（全アイテム表示グリッド）
  - インベントリとカタログを同一位置でトグル切り替え
  - クリエイティブモード時はホットバー常時表示
  - `/gamemode <survival|creative>` コマンドでモード切り替え

- ✅ **設定UI**
  - FPS調整 (30/60/120/144/240)
  - マウス感度調整 (0.001-0.01、±0.001ボタン)
  - トグルボタン (Enable Highlight / Enable UI Blur)
  - 即時反映（Applyボタンなし）
  - Escキー2回で通常プレイに自動復帰（カーソル自動グラブ）

- ✅ **ホットバーHUD**
  - 画面下部に9スロット表示
  - 選択中スロットを黄色枠でハイライト
  - アイテム名表示
  - 1-9キー、マウスホイールで選択切り替え
  - リアルタイム更新

- ✅ **ブロック破壊システム**
  - 左クリック長押しでブロック破壊
  - ブロックがアイテム化してインベントリに追加

- ✅ **右手アイテム表示**
  - 選択中アイテムを画面右下に3Dモデル表示
  - ホットバー選択と連動

## 🎯 ゲームプレイ

### 基本操作
| アクション | キー | 説明 |
|----------|------|------|
| 移動 | WASD | 前後左右移動 |
| 上昇/下降 | Space / Shift | ジェットパック飛行 |
| ダッシュ | Ctrl | 移動速度2倍 |
| カメラ | マウス | 視点操作 |
| インベントリ | E | インベントリUI開閉 |
| 設定 | Esc | 設定メニュー |
| デバッグ情報 | F3 | FPS、座標、メモリ表示 |

### 建築操作
| アクション | キー | 説明 |
|----------|------|------|
| ブロック破壊 | 左クリック長押し | ブロックを破壊してアイテム化 |
| ブロック設置 | 右クリック | ホットバー選択アイテムを設置 |
| ホットバー選択 | 1-9 / マウスホイール | アイテム切り替え |

### 機械システム
- **コンベアベルト**: アイテムを1.0ユニット/秒で輸送（最大4アイテム、0.25間隔）
- **採掘機 (Miner)**: `raw_ore`を1.0個/秒で無限生成
- **組立機 (Assembler)**: レシピに基づいて自動クラフト
  - 前面から入力、背面へ出力
  - 右クリックでUIを開いてレシピ選択
  - 入力インベントリ10スロット、出力インベントリ10スロット

### 電力システム
- **動力源 (Power Source)**: 回転エネルギーを生成
- **シャフト (Shaft)**: 動力を伝達
- **消費機械**: 負荷（stress）を消費
- **過負荷**: ネットワーク全体の負荷が容量を超えるとすべての機械が停止

## 🛠️ 技術仕様

### アーキテクチャ
- **言語**: Rust (stable)
- **エンジン**: Bevy 0.15
- **パラダイム**: ECS (Entity Component System)
- **シミュレーション**: 20 TPS固定タイムステップ
- **レンダリング**: 60 FPS目標

### プロジェクト構成
```
src/
├── core/           # 設定、レジストリ、入力、デバッグ
├── rendering/      # ボクセルレンダリング、メッシング、モデル
├── gameplay/       # ゲームロジック、機械、プレイヤー
│   ├── grid.rs     # SimulationGrid (機械配置管理)
│   ├── building.rs # 建築システム
│   ├── player.rs   # プレイヤー移動とカメラ
│   ├── power.rs    # 電力ネットワーク
│   ├── multiblock.rs # マルチブロック構造
│   ├── inventory.rs  # インベントリシステム
│   ├── commands.rs   # コマンドシステム
│   └── machines/   # Conveyor, Miner, Assembler
├── ui/             # UI (インベントリ、設定、機械操作)
└── network/        # マルチプレイヤー (stub)
```

### データファイル
```
assets/
├── data/
│   ├── blocks/     # ブロック定義 (YAML)
│   ├── items/      # アイテム定義 (YAML)
│   └── recipes/    # レシピ定義 (YAML)
├── textures/       # テクスチャ画像
├── models/         # 3Dモデル (.glb)
└── shaders/        # カスタムシェーダー (.wgsl)
```

### テスト
- **テスト数**: 15 (すべて成功)
- **カバレッジ**: コアシステムで70%以上
- **種類**: ユニットテスト、統合テスト、シミュレーションテスト
- **実行**: `cargo test`

## 📋 今後の予定

### Phase 4: 高度な自動化とスクリプティング
- [ ] Lua VM統合 (mlua)
- [ ] サンドボックスAPI（センサー、アクチュエータ、ロジックゲート）
- [ ] 信号システム（ワイヤー、ロジックゲート、数値処理）

### Phase 5: 最適化と配布
- [ ] マルチスレッド対応（地形、ロジスティクス、レンダリング）
- [ ] LODシステム（遠距離チャンク簡略化）
- [ ] Modding SDK（バニラをMODとして提供）
- [ ] 最終調整とリリース準備

### 将来のビジョン
- 🚀 **宇宙ステーション建設**: 最終目標として軌道上の宇宙ステーションを視覚的に完成させる
- 📐 **ブループリントシステム**: 工場設計を保存・共有
- 🎮 **クリエイティブ/サバイバルモード**: 多様なゲーム体験
- 🔧 **コミュニティMOD**: 活発なMODエコシステム

## 🚀 開発環境セットアップ

### 必要要件
- Rust 1.70+ (stable)
- Cargo
- Git

### ビルドと実行
```bash
# リポジトリのクローン
git clone https://github.com/your-username/infinite-voxel-factory.git
cd infinite-voxel-factory/my-bevy-project

# 依存関係のインストールとビルド
cargo build --release

# ゲーム実行
cargo run --release

# テスト実行
cargo test

# デバッグビルド実行（開発時）
cargo run
```

### 開発ツール
```bash
# コードフォーマット
cargo fmt

# 静的解析
cargo clippy

# 依存関係の脆弱性チェック
cargo audit
```

## 📚 ドキュメント

### プロジェクトドキュメント
- `.specify/memory/constitution.md` - プロジェクト憲章と設計原則
- `.specify/specs/core-game-mechanics.md` - 機能仕様書
- `.specify/memory/changelog.md` - 開発履歴
- `CLAUDE.md` - AI開発補助用メモリファイル

### 開発ガイド
- **命名規則**: snake_case (関数・モジュール), PascalCase (型)
- **コミットメッセージ**: 日本語、わかりやすく
- **テスト**: 新機能には必ずテストを追加
- **ドキュメント**: 公開APIには`///`コメント

## 🤝 コントリビューション

このプロジェクトはオープンソースです。以下の方法でコントリビュートできます：

1. **バグ報告**: Issueを作成してください
2. **機能提案**: Issueで議論してから実装
3. **プルリクエスト**: テストが通り、コンパイル警告がないことを確認
4. **ドキュメント改善**: 誤字修正や説明追加

## 📄 ライセンス

MIT License

## 🙏 謝辞

- **Bevy Engine**: 素晴らしいRust製ゲームエンジン
- **Factorio/Satisfactory/Minecraft**: ゲームデザインのインスピレーション
- **Rustコミュニティ**: 優れたツールとライブラリ

## 📞 連絡先

- GitHub Issues: バグ報告・機能提案
- Discussions: 質問・議論

---

**Status**: Phase 3完了 (UI/UXシステム含む) | Tests: 15/15 passing | Coverage: 70%+
