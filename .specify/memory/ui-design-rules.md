# UIデザインルール

UI実装時に必ず従うルール。新しいUIを追加する際は必ず参照すること。

---

## カラーパレット

| 用途 | Bevy Color | Hex |
|------|------------|-----|
| パネル背景 | `srgba(0.12, 0.12, 0.12, 0.9)` | `#1E1E1E` 90%透明 |
| スロット背景 | `srgb(0.2, 0.2, 0.2)` | `#333333` |
| 枠線（通常） | `srgb(0.33, 0.33, 0.33)` | `#555555` |
| 枠線（ホバー） | `WHITE` | `#FFFFFF` |
| 枠線（選択） | `srgb(1.0, 0.84, 0.0)` | `#FFD700` |
| テキスト主要 | `WHITE` | `#FFFFFF` |
| テキスト補助 | `srgb(0.67, 0.67, 0.67)` | `#AAAAAA` |
| プログレス（進行） | `srgb(0.30, 0.69, 0.31)` | `#4CAF50` |
| プログレス（背景） | `srgb(0.13, 0.13, 0.13)` | `#222222` |
| 閉じるボタン（ホバー） | `srgb(1.0, 0.33, 0.33)` | `#FF5555` |
| ボタン通常 | `srgb(0.25, 0.25, 0.30)` | |
| ボタンホバー | `srgb(0.35, 0.35, 0.42)` | |
| ボタン押下 | `srgb(0.20, 0.20, 0.25)` | |

---

## スペーシング定数

| 要素 | サイズ |
|------|--------|
| スロットサイズ | 54x54px |
| スロット間隔 | 4px |
| パネル内パディング | 20px |
| パネル間隔 | 20px |
| タイトル行の高さ | 25px |
| タイトル下余白 | 10px |
| 枠線太さ | 2px（パネル）, 1px（スロット） |
| 角丸 | 4px |

---

## ウィンドウ共通構造

すべてのUIウィンドウは以下の構造を持つ：

```
┌─────────────────────────────┐
│  タイトル            [×]   │  ← ヘッダー（高さ25px）
├─────────────────────────────┤  ← 区切り線（1px）
│                             │
│      コンテンツ領域         │  ← パディング20px
│                             │
└─────────────────────────────┘
```

### ヘッダー仕様
- 左: タイトルテキスト（WHITE、太字）
- 右: 閉じるボタン [×]（ホバーで赤）
- 高さ: 25px固定

---

## スロット共通デザイン

| 状態 | 背景 | 枠線 |
|------|------|------|
| 通常 | `#333` | `#555` 1px |
| ホバー | `#333` | `#FFF` 1px |
| 選択中 | `#333` | `#FFD700` 2px |
| ドラッグ中 | 半透明 | `#FFF` 1px |

### アイテム数表示
- 位置: スロット右下
- フォントサイズ: 12px
- 色: WHITE
- 影: 1px BLACK（視認性確保）
- 1個の時は非表示

---

## 各UI仕様

### インベントリUI（Eキーで開く）

```
┌─────────────────────────────┐
│  Inventory              [×] │
├─────────────────────────────┤
│  ┌──┬──┬──┬──┬──┬──┬──┬──┬──┐│
│  │  │  │  │  │  │  │  │  │  ││ メインインベントリ
│  ├──┼──┼──┼──┼──┼──┼──┼──┼──┤│ （27スロット: 3×9）
│  │  │  │  │  │  │  │  │  │  ││
│  ├──┼──┼──┼──┼──┼──┼──┼──┼──┤│
│  │  │  │  │  │  │  │  │  │  ││
│  └──┴──┴──┴──┴──┴──┴──┴──┴──┘│
│  ─────────────────────────  │ 区切り線（10px余白）
│  ┌──┬──┬──┬──┬──┬──┬──┬──┬──┐│
│  │1 │2 │3 │4 │5 │6 │7 │8 │9 ││ ホットバー（9スロット）
│  └──┴──┴──┴──┴──┴──┴──┴──┴──┘│
│                         🗑️  │ ゴミ箱（右下）
└─────────────────────────────┘
```

- 合計: 36スロット
- スタック上限: 999
- 操作: クリックで移動、Shift+クリックで一括移動

### 機械UI（右クリックで開く）

**精錬炉**
```
┌─────────────────────────────┐
│  Furnace                [×] │
├─────────────────────────────┤
│      ┌──┐                   │
│      │燃│ Fuel              │
│      └──┘                   │
│        🔥                   │ 炎アイコン（稼働中のみ表示）
│      ┌──┐    ┌──┐          │
│      │入│ →  │出│          │
│      └──┘    └──┘          │
│      ████████░░ 80%        │ プログレスバー
└─────────────────────────────┘
```

**粉砕機**
```
┌─────────────────────────────┐
│  Crusher                [×] │
├─────────────────────────────┤
│      ┌──┐    ┌──┐          │
│      │入│ →  │出│          │
│      └──┘    └──┘          │
│      ████████░░ 80%        │
└─────────────────────────────┘
```

### クリエイティブインベントリUI

```
┌─────────────────────────────┐
│  Creative               [×] │
├─────────────────────────────┤
│  [Blocks] [Ores] [Machines] │ カテゴリタブ
│  ┌──┬──┬──┬──┬──┬──┬──┬──┬──┐│
│  │  │  │  │  │  │  │  │  │  ││ アイテム一覧
│  ├──┼──┼──┼──┼──┼──┼──┼──┼──┤│ （カテゴリ別表示）
│  │  │  │  │  │  │  │  │  │  ││
│  └──┴──┴──┴──┴──┴──┴──┴──┴──┘│
└─────────────────────────────┘
```

- クリックで選択スロットに64個追加

### チャット/コマンドUI（Tまたは/キー）

```
┌─────────────────────────────┐
│ > /creative                 │ 入力欄
└─────────────────────────────┘
```

- 位置: 画面下部中央
- 背景: 半透明黒
- Enterで実行、ESCでキャンセル

---

## プログレスバー仕様

| 要素 | 値 |
|------|-----|
| 高さ | 8px |
| 幅 | スロット2個分 + 間隔（112px） |
| 背景 | `#222222` |
| 進行 | `#4CAF50` |
| 角丸 | 2px |
| テキスト | 右に `XX%` 表示 |

---

## レイアウト原則

### CSS Grid使用
```rust
Style {
    display: Display::Grid,
    grid_template_columns: vec![GridTrack::auto(); 9], // 9列
    row_gap: Val::Px(4.0),
    column_gap: Val::Px(4.0),
    align_items: AlignItems::Start, // 上揃え
    ..default()
}
```

### 禁止事項
- `margin`/`padding`でのハードコード位置調整
- 空のSpacingノードによる高さ調整
- パネル間の構造不一致
- **複数の独立したFlexbox/Gridを横に並べる**（ズレの原因）

### 推奨
- CSS Gridで自動整列
- 色・サイズは定数を使用
- 隣接パネルは同じ構造

---

## グリッド整列ルール（重要）

### 問題：複数パネルがズレる

**NG例**：装備パネルとインベントリパネルが別のFlexbox
```rust
// ❌ これはズレる
Row {
    EquipmentPanel { ... }  // 独自のGrid
    InventoryPanel { ... }  // 独自のGrid
}
```

**OK例**：1つのGridで全体を管理
```rust
// ✅ これならズレない
Grid {
    columns: [装備, gap, inv1, inv2, inv3, inv4, inv5, inv6, inv7, inv8, inv9]
    // 全スロットが同じGridに属する
}
```

### 実装パターン

**横に並ぶ要素がある場合**：
```rust
Style {
    display: Display::Grid,
    grid_template_columns: vec![
        GridTrack::px(54.0),   // 左パネル列
        GridTrack::px(20.0),   // 間隔（gap列）
        GridTrack::px(54.0),   // 右パネル列1
        GridTrack::px(54.0),   // 右パネル列2
        // ...
    ],
    row_gap: Val::Px(4.0),
    // column_gapは使わない（gap列で制御）
    ..default()
}
```

**スロットの配置**：
```rust
// 装備スロット（列0、行0-2）
spawn_slot(grid_column: 0, grid_row: 0);
spawn_slot(grid_column: 0, grid_row: 1);
spawn_slot(grid_column: 0, grid_row: 2);

// インベントリスロット（列2-10、行0-2）
for row in 0..3 {
    for col in 0..9 {
        spawn_slot(grid_column: col + 2, grid_row: row);
    }
}
```

### チェックリスト（横並びUI）

- [ ] 1つのCSS Gridで全体を管理
- [ ] 列定義で間隔を明示的に設定
- [ ] 各スロットに`grid_column`と`grid_row`を指定
- [ ] 別々のFlexbox/Gridを横に並べていない

---

## 実装チェックリスト

新しいUIを作成する際：

- [ ] ウィンドウ共通構造（ヘッダー＋閉じるボタン）を使用
- [ ] カラーパレットの色を使用
- [ ] スロットサイズ54x54pxを使用
- [ ] スペーシング定数を使用
- [ ] CSS Gridで`align_items: AlignItems::Start`
- [ ] プログレスバーは共通仕様に従う
- [ ] ホバー/選択状態のフィードバックあり

---

## 参照実装

- `src/setup/ui/machine_ui.rs` - 機械UI（Furnace, Crusher, Miner）**デザインルール準拠**
- `src/setup/ui/inventory_ui.rs` - インベントリUI
- `src/systems/inventory_ui.rs` - インベントリロジック

---

## 変更履歴

### 2026-01-03
- 機械UI（Furnace, Crusher, Miner）をデザインルールに準拠させた
  - スロットサイズ54x54px
  - カラーパレット統一（PANEL_BG, SLOT_BG, SLOT_BORDER等）
  - ヘッダー構造（タイトル + 閉じるボタン）
  - プログレスバー高さ8px、緑色進行表示
- VOXモデルのY座標オフセット修正（底面原点対応）
