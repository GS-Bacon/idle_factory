# 信号・Luaスクリプトシステム

## 概要

レッドストーン風の信号システム + Luaによる高度な自動化。

## 信号システム

### 基本仕様

| 項目 | 値 |
|------|-----|
| 信号強度 | 0〜15（0=OFF、1-15=ON） |
| 伝達 | 信号ワイヤー経由 |
| 減衰 | 1ブロックあたり-1（リピーターで復元） |

### 信号ワイヤー

| 項目 | 値 |
|------|-----|
| 設置単位 | 1ブロック |
| 自動接続 | 隣接ワイヤー/機械に自動接続 |
| 色分け | 16色（混線防止） |

### 信号の入力源

| デバイス | 出力 |
|----------|------|
| レバー | 手動ON/OFF（0 or 15） |
| ボタン | 押している間ON |
| 感圧板 | プレイヤー/アイテム検知 |
| 在庫センサー | チェスト内アイテム量に応じた信号 |
| タイマー | 一定間隔でパルス |
| 昼夜センサー | 時間帯に応じた信号 |

### 信号の出力先

| デバイス | 動作 |
|----------|------|
| パワースイッチ | 信号でON/OFF |
| ランプ | 信号で点灯 |
| ドア/ゲート | 信号で開閉 |
| バルブ | 信号で液体遮断 |
| スマートスプリッター | 信号でフィルタ切替 |

### ロジックゲート

| ゲート | 入力 | 出力 |
|--------|------|------|
| NOT | 1 | 入力の反転 |
| AND | 2 | 両方ONならON |
| OR | 2 | どちらかONならON |
| XOR | 2 | 片方だけONならON |
| NAND | 2 | AND + NOT |
| NOR | 2 | OR + NOT |

### リピーター

| 機能 | 説明 |
|------|------|
| 信号増幅 | 減衰した信号を15に復元 |
| 遅延 | 1-4ティック（0.05-0.2秒）の遅延 |
| 一方向 | 逆方向には伝わらない |

## ワイヤレス信号

### 送信機 (Signal TX)

| 項目 | 値 |
|------|-----|
| 範囲 | 無制限（同チャンネル） |
| チャンネル | 1〜16 |
| 入力 | 隣接信号ワイヤー |

### 受信機 (Signal RX)

| 項目 | 値 |
|------|-----|
| チャンネル | 1〜16 |
| 出力 | 受信した信号強度 |

**用途:** 離れた場所の機械制御、グローバルな電力管理

---

## Luaスクリプト

### 概要

高度な自動化のためのプログラミング。
Factorioのコンビネーター + ComputerCraft的な機能。

### コンピュータブロック

| 項目 | 値 |
|------|-----|
| サイズ | 1×1×1 |
| 入力ポート | 6面すべて |
| 出力ポート | 6面すべて |
| 実行間隔 | 1ティック（0.05秒） |

### サンドボックス

セキュリティのため制限あり。

| 許可 | 禁止 |
|------|------|
| 数値演算 | ファイルI/O |
| 文字列操作 | ネットワーク |
| テーブル | os.execute |
| ゲームAPI | require（許可リスト以外） |

### ゲームAPI

```lua
-- 信号
signal.get(direction)        -- 指定方向の入力信号を取得
signal.set(direction, value) -- 指定方向に信号を出力

-- インベントリ（隣接チェスト）
inventory.count(direction, item_id) -- アイテム数を取得
inventory.list(direction)           -- アイテム一覧

-- 機械状態（隣接機械）
machine.get_progress(direction)     -- 処理進捗 0-100
machine.get_power(direction)        -- 電力状態
machine.is_working(direction)       -- 稼働中か

-- 時間
time.get_tick()                     -- 現在のゲームティック
time.get_day_time()                 -- 昼夜の時間（0-24000）

-- ストレージ（永続データ）
storage.get(key)                    -- 値を取得
storage.set(key, value)             -- 値を保存
```

### 例：在庫に応じた生産制御

```lua
-- 鉄板が1000個未満なら生産ON
local count = inventory.count("north", "iron_plate")
if count < 1000 then
    signal.set("south", 15)  -- 生産ラインON
else
    signal.set("south", 0)   -- 生産ラインOFF
end
```

### 例：昼夜で電力切替

```lua
local day_time = time.get_day_time()
if day_time > 6000 and day_time < 18000 then
    -- 昼：ソーラー優先
    signal.set("east", 15)
else
    -- 夜：燃料発電
    signal.set("west", 15)
end
```

### ロボット

Luaで制御できる移動ユニット。

| 項目 | 値 |
|------|-----|
| サイズ | 0.5×0.5×0.5 |
| インベントリ | 4スロット（拡張で10） |
| 動作 | 移動、採掘、設置、アイテム操作 |
| 電力 | バッテリー（充電必要） |

#### ロボットAPI

```lua
-- 移動
robot.forward()
robot.back()
robot.up()
robot.down()
robot.turn_left()
robot.turn_right()

-- 操作
robot.dig()              -- 前方を採掘
robot.place(slot)        -- 前方に設置
robot.suck()             -- 前方からアイテム回収
robot.drop()             -- 前方にアイテム投下

-- 状態
robot.get_fuel()         -- 残り燃料
robot.detect()           -- 前方にブロックがあるか
```

### スクリプト管理

| 機能 | 説明 |
|------|------|
| エディタ内蔵 | コンピュータUIでスクリプト編集 |
| ファイル保存 | スクリプトはワールドに保存 |
| コピー＆ペースト | 他のコンピュータに複製可能 |
| エラー表示 | 実行時エラーをUI表示 |

## 設計思想

| ポイント | 理由 |
|----------|------|
| 信号は16段階 | レッドストーン互換、直感的 |
| 色分けワイヤー | 複雑な配線の整理 |
| Luaサンドボックス | セキュリティ、MOD互換 |
| ロボットは終盤 | 学習曲線を緩やかに |
