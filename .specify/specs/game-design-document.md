# Game Design Document: Infinite Voxel Factory

**Version:** 1.0
**Date:** 2025-12-18
**Status:** Draft (壁打ち完了)

---

## 1. ゲーム概要

### コンセプト
3Dボクセル工場シミュレーション。Factorio、Satisfactory、Minecraft(Create Mod)から影響を受けつつ、敵やサバイバル要素を最小限に抑え、純粋な「自動化」と「建築」に特化。

### コアループ
1. 資源を採掘
2. 加工ラインを構築
3. 製品を納品プラットフォームへ搬入
4. クエスト達成で報酬獲得
5. 宇宙ステーション建設が進行
6. 繰り返し（無限に拡張可能）

### 最終目標
- 宇宙ステーションの完成
- 完成後も追加の宇宙ステーション建設で無限にプレイ可能

---

## 2. 納品プラットフォーム

### 基本仕様
| 項目 | 仕様 |
|------|------|
| サイズ | 12×12ブロック |
| 位置 | スポーン地点直近 |
| 破壊 | 不可（絶対保護） |
| ポート数 | 各辺12個（計48個） |
| 初期解放 | 各辺4個（計16個） |

### ポートの動作
- 1ポート = 1種類の搬入のみ
- 接続物（コンベア/パイプ/ワイヤー/シャフト）で受付種類が動的決定
- クエストに必要なアイテムは消費してカウント
- 不要なアイテムは廃棄（視覚的に警告表示）

### 宇宙ステーション可視化
- 上空に常時表示（画像差し替え方式）
- フェーズ完了ごとに段階的に完成していく
- タスクツリーでも進捗確認可能

---

## 3. プレイヤー

### ステータス
| 項目 | 仕様 |
|------|------|
| 最大HP | 10 |
| HP回復 | 自然回復、食べ物、装備 |
| 空腹 | なし |
| 死因 | 落下、溶岩 |
| 死亡ペナルティ | 経験値ロスト（インベントリ保持） |
| リスポーン | スポーンアンカー（ベッド相当） |

### 経験値
- 獲得方法: クラフト、納品、採掘
- 用途: エンチャント付与

### 装備効果
- 移動速度アップ
- 建築範囲拡大
- 装飾（見た目）
- ジェットパック（燃料→電池→無限と段階的）
- 高度制限なし

### インベントリ
| 項目 | 仕様 |
|------|------|
| ホットバー | 10スロット |
| メインインベントリ | 実装済み |
| 最大スタック | 999 |

---

## 4. ワールド

### サイズ
| 項目 | 値 |
|------|-----|
| 水平方向 | 無限生成 |
| 高さ上限 | Y: +256 |
| 高さ下限 | Y: -256 |
| 海抜/地上 | Y: 64 |
| 総高さ | 512ブロック |

### バイオーム
- **自然バイオーム**: 森林、砂漠、雪原など（ブロック生成）
- **資源バイオーム**: 自然バイオームにオーバーレイされるデータ層
  - 同エリアに複数資源が重複可能
  - 確率で取得資源が変動
  - 境界はグラデーション（両方が少しずつ取れる）

### 資源濃度
- 濃度が高いと1回の採掘で複数ドロップ確率UP
- 採掘量は無限

### 天候
- 昼夜サイクルあり
- 天候あり（雨など）
- 雨の効果:
  - 水車効率UP
  - 植物成長促進
  - きのこ成長
  - 野ざらし機械の効率低下/破損

### 照明
- 暗いと見えにくい（それだけ）
- 照明種類: 松明 → 電灯 → 白熱灯（範囲拡大）
- エディタで定義可能

---

## 5. 物流システム

### コンベア
| 項目 | 仕様 |
|------|------|
| 上位版 | あり（速度向上） |
| 分岐先なし | 詰まる |
| 複数分岐 | ラウンドロビン |
| 合流 | ジッパー合流 |
| 詰まり解消 | 手動取り出し |
| 上位機能 | 詰まり検知コンベア + Luaロボット連携 |

### フィルター
- コンベア上に被せるタイプ
- 指定アイテムは通過、それ以外は分岐へ

### パイプ（液体）
| 項目 | 仕様 |
|------|------|
| 上位版 | あり（流量増加） |
| 異種液体 | 接続不可（隣ブロックに空パイプとして設置） |
| 空パイプ | 何でも接続可 |
| ドレインバルブ | あり（パイプを空に） |
| 液体廃棄 | ろ過後に無限水源へ返却可 |

### 液体挙動
- マイクラ式の流体挙動
- 漏れた液体で機械がショート・停止
- 回収: バケツ、ポンプ

### タンク
| 項目 | 仕様 |
|------|------|
| 容量 | 10,000mb（10バケツ分） |
| マルチブロック | 正方形積み上げで巨大化 |
| 高温タンク | 専用ブロック必須 |
| 通常タンク + 高温液体 | 破損・漏出 |
| 液体混合 | 不可（入らない） |
| 液面表示 | あり |
| メーター取付 | 可能 |

### 気体
- タンク必要（液面表示なし）
- 気体を扱うレシピあり

### シャフト（トルク伝達）
| 項目 | 仕様 |
|------|------|
| 種類 | 1種類のみ |
| 逆回転接続 | シャフト破壊 |
| 破壊時 | アイテム化、接続機械停止 |
| 復旧 | 手動再建設（後にロボット対応） |
| ギア比変換 | あり（Create mod式） |

### ギアボックス
- 可変比率
- ギア組み合わせより小サイズで実現可能
- クラッチあり（信号でON/OFF）

---

## 6. 動力システム

### トルク
- シャフトで物理的に伝達
- ギア比で速度/トルク変換

### 電力
| 項目 | 仕様 |
|------|------|
| 伝達 | ワイヤー |
| 概念 | 流量のみ（電圧なし） |
| 上位ワイヤー | 流量増加 |
| 蓄電池 | あり |

### 動力変換ルート
1. **蒸気直接**: 蒸気 → 蒸気エンジン → トルク
   - 低ロス、大規模設備、高コスト
2. **電力経由**: 蒸気タービン → 発電 → モーター → トルク
   - コンパクト、制御性良好、発電設備は大きい

### 初期動力
- 手回しクランク: 採掘機1台分程度
- 水車/風車: 序盤で作成可能

### 熱システム
| 項目 | 仕様 |
|------|------|
| 伝達 | 蒸気パイプ、隣接 |
| 熱源 | ボイラー、溶岩、電熱器 |
| 熱不足 | 閾値以下で停止、適正以下で減速 |
| 過熱 | 機械破損 |

### 溶岩
- 液体として扱う
- ため池に存在
- 発電可能
- クラフト可能（石+燃料+熱）
- 用途: 発電、製錬熱源

### 燃料種類
- 木炭、石炭、重油、ウラン、バイオ燃料など
- 発熱量はエディタで設定

---

## 7. 機械システム

### 基本仕様
- レシピは機械に保持されない
- 入力アイテム + 機械種類で自動判定
- 搬入/搬出方向は固定（エディタで定義）

### 機械一覧
| カテゴリ | 機械 |
|----------|------|
| 採掘 | 採掘機 |
| 物流 | コンベア、パイプ、ポンプ、タンク（通常/高温/気体） |
| 加工 | アセンブラ、製錬炉、洗浄機、圧延機、CNC旋盤、破砕機、遠心分離機、蒸留塔、樹脂成形機 |
| 動力 | ボイラー、電熱器、蒸気エンジン、蒸気タービン、発電機、モーター |
| その他 | 防振台、メーター類（温度計、圧力計、流量計）、チェスト |

### 機械ティア
- MKI → MKII など上位版あり
- 速度向上、並列処理数増加
- アップグレード: 上位機械を右クリックで適用、旧機械ドロップ

### アップグレードモジュール
| 項目 | 仕様 |
|------|------|
| スロット数 | 5種類/機械 |
| スタック | 同種6個まで |
| 種類 | 省エネ、速度、静音 |

### 振動システム
| 項目 | 仕様 |
|------|------|
| 影響範囲 | 3×3×3 |
| 効果 | 近隣機械の性能低下 |
| 遮断方法 | 防振台、距離 |
| 静音UP | 振動も減少 |

### 副産物
- 確率/確定はレシピ依存
- 同形態は同出力口
- 異形態（液体/固体）は別出力口

### マルチブロック
- エディタで定義
- レンチでクリックして確定
- 設置ブロックで性能変化可能

### ドロップ時の状態保持
- 内部インベントリ: 保持
- エンチャント: 保持
- アップグレードモジュール: 保持

---

## 8. 信号・自動化システム

### 信号
| 項目 | 仕様 |
|------|------|
| 信号強度 | 1〜16 |
| 減衰 | 距離で減衰 |
| 伝達 | ワイヤー必須 |
| ワイヤレス | 専用機器あり |

### コンピュータ
- 信号入出力
- 機械API（設置時に専用APIアクセス）
- ネットワーク通信（他コンピュータと連携）
- Lua制御

### ロボット
| 項目 | 仕様 |
|------|------|
| 種類 | 固定コンピュータ型、移動ロボット型 |
| 操作範囲 | 3×3×3（隣接+斜め） |
| 入手 | クラフト（無制限） |
| 移動 | 1ブロック単位、滑らかアニメーション |
| 能力 | プレイヤー操作の自動化（移動、破壊、設置） |
| 制約 | 溶岩/水NG、落下ダメージあり（アップグレードで耐性可） |
| インベントリ | 基本4×4、拡張で5×10 |
| 採掘速度 | ツール依存+エンチャント |
| 制御 | Lua |

### CPU/メモリ
| 項目 | 仕様 |
|------|------|
| CPU | 1tickあたり命令数制限 |
| メモリ | OpenComputers式（実行時メモリ使用量制限） |
| 性能決定 | クラフトで選択 |

### ブループリント
- 建築をJSONで保存
- ロボットで自動建築

---

## 9. クエストシステム

### 構造
| 項目 | 仕様 |
|------|------|
| メインクエスト | シーケンシャル（順番に進行） |
| サブクエスト | 並列進行可能 |
| スキップ | 不可 |
| サブ中断 | 可能（進捗保持、アイテム返却なし） |

### クエスト競合時の優先度
1. メインクエスト優先
2. 受注順
3. プレイヤーが優先度変更可能

### 報酬
- ポート解放
- アイテム支給（機械、レア資源、装備）
- アンロック系はなし

### 定義
- レシピエディタで設定

---

## 10. エンチャントシステム

### 付与方法
| 方法 | 特徴 |
|------|------|
| 自動付与 | 固定エンチャント |
| 手動付与 | 経験値消費、ガチャ要素あり |

### エンチャント種類
| 対象 | 効果 |
|------|------|
| ツール | 速度UP、耐久UP、範囲UP、幸運 |
| 機械 | 副産物確率UP |

---

## 11. レンチ機能

- マルチブロック確定
- コンベア分岐の制御
- 機械の回転
- 撤去
- 設定変更

---

## 12. 農業システム

- 農業/栽培システムあり
- 自動農業可能
- 食べ物効果: HP回復、採掘力UP等（エディタ定義）

---

## 13. UI/HUD

### 常時表示
- ミニマップ（地形、機械、他プレイヤー、資源バイオーム境界）
- ホットバー（10スロット）
- HP（ゆるめの表示）

### 別画面
- 全体マップ
- クエスト一覧（優先度変更可能）
- タスクツリー（宇宙ステーション進捗）

### その他UI
- 看板/ラベル（ライン識別用）

---

## 14. マルチプレイ

| 項目 | 仕様 |
|------|------|
| 人数 | 無制限（スペック依存） |
| 他人の建築破壊 | サーバー設定で制御 |

---

## 15. サウンド

| 項目 | 仕様 |
|------|------|
| BGM | なし |
| 環境音 | あり（エディタ編集可） |
| 機械音 | あり（エディタ編集可） |

---

## 16. エディタ定義項目まとめ

レシピエディタで定義可能な項目:
- アイテム
- レシピ（加工フロー）
- クエスト
- マルチブロック機械
- バイオームパラメータ
- 燃料発熱量
- 機械出力
- 機械搬入/搬出方向
- 照明範囲
- 食べ物効果
- 音声

---

## 17. 未確定/後回し項目

- ウラン/原子力の詳細仕様
- 特殊天候（雪/砂嵐）のバイオーム依存
- 地下水脈の地形生成
- 海辺上位風車の仕様詳細

---

## 18. 技術スタック

- **言語**: Rust (stable)
- **エンジン**: Bevy 0.15
- **スクリプト**: Lua (mlua)
- **データ**: YAML (serde_yaml)
- **シミュレーション**: 20 TPS固定タイムステップ

---

## Related Documents

- `.specify/specs/core-game-mechanics.md` - 実装済み機能の詳細仕様
- `.specify/memory/constitution.md` - プロジェクト憲章
- `.specify/memory/changelog.md` - 開発履歴

---

*このドキュメントは2025-12-18の壁打ちセッションで決定した仕様をまとめたものです。*
