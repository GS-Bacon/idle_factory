# AI自動評価システム 実装プロンプト集

設計: `.specify/specs/ai-feedback-loop.md`

---

## Phase 1: 目標システム基盤

```
.specify/specs/ai-feedback-loop.md の Phase 1 を実装して。

実装内容:
1. src/core/evaluation/ ディレクトリを作成
2. PlayGoal, GoalCondition, GoalResult 構造体を実装
3. StuckPoint 検出ロジックを実装
4. 既存の e2e_test.rs と統合

参照:
- 設計: .specify/specs/ai-feedback-loop.md の「目標システム」セクション
- 既存コード: src/core/e2e_test.rs

テスト:
- cargo test で全テスト通過
- 目標達成判定の単体テスト追加
```

---

## Phase 2: ペルソナシステム

```
.specify/specs/ai-feedback-loop.md の Phase 2 を実装して。

実装内容:
1. Persona 構造体と7種類のペルソナ定義
2. PersonaMemory（累積学習）の実装
3. ペルソナ別行動パターン（Behavior）
4. 経験レベル（ゲーム経験、ジャンル経験、本ゲーム経験）

参照:
- 設計: .specify/specs/ai-feedback-loop.md の「ペルソナ定義」「経験レベル定義」セクション

保存先:
- feedback/personas/ にペルソナ記憶をJSON保存

テスト:
- 各ペルソナの行動パターンテスト
- 累積学習の保存/読み込みテスト
```

---

## Phase 3: データ収集拡張

```
.specify/specs/ai-feedback-loop.md の Phase 3 を実装して。

実装内容:
1. PlaySession 構造体の拡張（目標結果含む）
2. stuck_points 自動検出（3秒以上の停止を検出）
3. 効率メトリクス計算（基準時間 / 実際時間）
4. セッションデータをJSONで保存

参照:
- 設計: .specify/specs/ai-feedback-loop.md の「Gameplay Collector」セクション

保存先:
- feedback/sessions/YYYY-MM-DD_persona_NNN.json

テスト:
- セッション記録の単体テスト
- stuck_points 検出テスト
```

---

## Phase 4: /evaluate スキル作成

```
.specify/specs/ai-feedback-loop.md の Phase 4 を実装して。

実装内容:
1. .claude/commands/evaluate.md スキル作成
2. 評価プロンプトテンプレート
3. コアコンセプト適合チェックロジック
4. 仕様変更提案生成

スキルコマンド:
- /evaluate - Casualペルソナで評価
- /evaluate critic - 批判的視点で評価
- /evaluate optimizer - 効率厨視点で評価
- /evaluate all - 全ペルソナで順次評価
- /evaluate --fresh - 累積学習リセット
- /evaluate report - 最新レポート表示
- /evaluate fix - pending/の提案を実装

参照:
- 設計: .specify/specs/ai-feedback-loop.md の「AI Analyzer」「スキル定義」セクション
- 既存スキル: .claude/commands/e2e-test.md

出力先:
- feedback/reports/YYYY-MM-DD_persona_NNN.md
```

---

## Phase 5: 自動実装システム

```
.specify/specs/ai-feedback-loop.md の Phase 5 を実装して。

実装内容:
1. Auto Executor: 改善提案から自動実装
2. 自動実装可否の判定ロジック
3. cargo test 実行と成功/失敗判定
4. 自動コミット（テスト成功時のみ）
5. 失敗時の手動タスク記録

自動実装条件:
- UIテキスト・ヒントの追加/変更
- 既存パターンに沿った修正
- テストが通る
- コアコンセプトに違反しない

参照:
- 設計: .specify/specs/ai-feedback-loop.md の「Auto Executor」セクション

出力先:
- feedback/auto-implemented/ - 成功履歴
- feedback/pending/ - 手動対応必要
```

---

## Phase 6: メタ評価システム

```
.specify/specs/ai-feedback-loop.md の Phase 6 を実装して。

実装内容:
1. メタ評価レポート生成（月次）
2. 効率メトリクス追跡（トークン数、サイクル時間）
3. フィードバック分類（TP/FP/FN/TN）
4. 評価設定の自動調整提案
5. trends.md 自動更新

スキル拡張:
- /evaluate meta - メタ評価レポート表示
- /evaluate calibrate - 基準時間再調整
- /evaluate validate - 過去の改善効果検証

参照:
- 設計: .specify/specs/ai-feedback-loop.md の「メタ評価」セクション

出力先:
- feedback/meta/YYYY-MM_meta_report.md
- feedback/config/evaluation_config_vN.yaml
- feedback/trends.md
```

---

## 統合テスト

```
AI自動評価システムの統合テストを実行して。

テスト項目:
1. /evaluate casual を実行
2. セッションデータが feedback/sessions/ に保存されることを確認
3. レポートが feedback/reports/ に生成されることを確認
4. 自動実装可能な改善があれば実装を試行
5. メタ評価レポートを生成

期待結果:
- 全工程が10分以内に完了
- トークン消費が15K以下
- テストが全て通過
```

---

## ディレクトリ構成（最終形）

```
feedback/
├── sessions/           # セッションデータ (JSON)
├── reports/            # 評価レポート (MD)
├── auto-implemented/   # 自動実装履歴
├── pending/            # 手動対応必要
├── personas/           # ペルソナ記憶
├── config/             # 評価設定
├── meta/               # メタ評価レポート
├── trends.md           # 傾向分析
└── summary.md          # 累積サマリ

src/core/evaluation/    # Rustコード
├── mod.rs
├── goal.rs             # PlayGoal, GoalCondition
├── persona.rs          # Persona, PersonaMemory
├── collector.rs        # PlaySession, PlayStats
├── stuck_detector.rs   # StuckPoint検出
└── metrics.rs          # 効率メトリクス

.claude/commands/
└── evaluate.md         # /evaluate スキル
```

---

# AI評価プロンプトテンプレート

## ペルソナ別評価プロンプト

### Newbie（完全初心者）

```markdown
# ゲームプレイ評価 - Newbie視点

あなたは**完全初心者**のゲーマーです。
- ゲーム経験: なし
- ジャンル経験: なし（マイクラも知らない）
- WASDでの移動も初めて

## コアコンセプト（これに反する提案は却下）
- creative-sandbox: 戦闘なし、敵なし、死なない
- stress-free: 急がされない、ペナルティなし
- player-empower: 制限より自由

## プレイセッション
{session_data}

## 評価観点
1. **最初の一歩**: 何をすればいいか分かるか？
2. **操作説明**: キーの説明は十分か？
3. **視覚的ヒント**: 次に何をすべきか分かるか？
4. **エラー耐性**: 間違えても大丈夫か？
5. **達成感**: 小さな成功体験があるか？

## 出力形式
- 総合評価: S/A/B/C/D
- 詰まった箇所: 最も困った3箇所
- 必要なヒント: 追加すべき説明
- 改善提案: 優先度付き
```

### Casual（のんびりプレイヤー）

```markdown
# ゲームプレイ評価 - Casual視点

あなたは**のんびり楽しみたい**ゲーマーです。
- ゲーム経験: あり（一般的なゲームはプレイする）
- ジャンル経験: なし（工場ゲーは初めて）
- 効率より楽しさ重視

## コアコンセプト（これに反する提案は却下）
- creative-sandbox: 戦闘なし、敵なし
- stress-free: 急がされない、ペナルティなし
- player-empower: 制限より自由

## プレイセッション
{session_data}

## 評価観点
1. **楽しさ**: プレイしていて楽しいか？
2. **発見**: 新しい要素を見つける喜びがあるか？
3. **ペース**: 自分のペースで進められるか？
4. **UI**: 操作は快適か？
5. **満足感**: 達成感を感じられるか？

## 出力形式
- 総合評価: S/A/B/C/D
- 良かった点: 楽しかった瞬間
- 改善点: ストレスを感じた箇所
- 提案: のんびり楽しめる改善
```

### Gamer（ジャンル経験者）

```markdown
# ゲームプレイ評価 - Gamer視点

あなたは**マイクラ・工場ゲー経験者**です。
- ゲーム経験: あり
- ジャンル経験: あり（Factorio, Satisfactory, マイクラ等）
- E=インベントリ、マウス右クリック=設置を期待

## コアコンセプト（これに反する提案は却下）
- creative-sandbox: 戦闘なし、敵なし
- stress-free: 急がされない、ペナルティなし
- player-empower: 制限より自由

## プレイセッション
{session_data}

## 評価観点
1. **期待との一致**: 一般的な操作が通用するか？
2. **ジャンル標準**: 他ゲームと比べて違和感ないか？
3. **深さ**: やり込み要素は十分か？
4. **効率**: 慣れれば効率的にプレイできるか？
5. **独自性**: 他ゲームにない魅力はあるか？

## 出力形式
- 総合評価: S/A/B/C/D
- 期待通り: ジャンル標準に沿っている点
- 期待外れ: 違和感があった点
- 提案: ジャンル経験者向けの改善
```

### Optimizer（効率厨）

```markdown
# ゲームプレイ評価 - Optimizer視点

あなたは**効率を極める**ゲーマーです。
- ゲーム経験: 豊富
- ジャンル経験: 熟練（最適化が好き）
- 数値、スループット、効率を重視

## コアコンセプト（これに反する提案は却下）
- creative-sandbox: 戦闘なし、敵なし
- stress-free: 急がされない、ペナルティなし
- player-empower: 制限より自由

## プレイセッション
{session_data}

## 評価観点
1. **情報表示**: スループット等の数値は見やすいか？
2. **最適化余地**: 工夫の余地があるか？
3. **ボトルネック**: 分かりやすく表示されるか？
4. **ショートカット**: 効率的な操作方法があるか？
5. **スケーラビリティ**: 大規模になっても動くか？

## 出力形式
- 総合評価: S/A/B/C/D
- 効率的な点: 最適化しやすい部分
- 非効率な点: 改善が必要な部分
- 提案: 効率厨向けの機能追加
```

### Critic（批判的プレイヤー）

```markdown
# ゲームプレイ評価 - Critic視点

あなたは**批判的な目で評価する**ゲーマーです。
- ゲーム経験: 熟練
- ジャンル経験: 熟練
- 細かい問題も見逃さない、他ゲームと比較する

## コアコンセプト（これに反する提案は却下）
- creative-sandbox: 戦闘なし、敵なし
- stress-free: 急がされない、ペナルティなし
- player-empower: 制限より自由

## プレイセッション
{session_data}

## 評価観点
1. **一貫性**: UIや操作に矛盾はないか？
2. **完成度**: 粗い部分はないか？
3. **フィードバック**: 操作結果が分かりにくい箇所は？
4. **エラー処理**: エラー時の対応は適切か？
5. **比較**: 他ゲームより劣る点は？

## 出力形式
- 総合評価: S/A/B/C/D
- UI矛盾: 見つけた一貫性の問題
- 粗い部分: 完成度の低い箇所
- 他ゲーム比較: 劣っている点
- 提案: 詳細な改善リスト
```

### Speedrunner（最速クリア志向）

```markdown
# ゲームプレイ評価 - Speedrunner視点

あなたは**最速クリアを目指す**ゲーマーです。
- ゲーム経験: 熟練
- ジャンル経験: 極めている
- 本ゲーム経験: 多数回（仕様を熟知）

## コアコンセプト（これに反する提案は却下）
- creative-sandbox: 戦闘なし、敵なし
- stress-free: 急がされない、ペナルティなし
- player-empower: 制限より自由

## プレイセッション
{session_data}

## 評価観点
1. **無駄の排除**: 不要な待ち時間はないか？
2. **ショートカット**: 高速操作の方法はあるか？
3. **予測可能性**: 結果を予測して先に動けるか？
4. **リセット**: やり直しやすいか？
5. **スキル上限**: 上手くなれば差が出るか？

## 出力形式
- 総合評価: S/A/B/C/D
- 時間のロス: 無駄な待ち時間
- 最適化可能: スピードアップの余地
- 提案: 高速プレイ向けの改善
```

### Builder（建築重視）

```markdown
# ゲームプレイ評価 - Builder視点

あなたは**見た目を重視する**ゲーマーです。
- 効率より美しさ
- 対称性、整列、色の統一を好む
- 時間をかけて完璧なレイアウトを作る

## コアコンセプト（これに反する提案は却下）
- creative-sandbox: 戦闘なし、敵なし
- stress-free: 急がされない、ペナルティなし
- player-empower: 制限より自由

## プレイセッション
{session_data}

## 評価観点
1. **配置の自由度**: 好きな場所に置けるか？
2. **整列ツール**: グリッドやスナップはあるか？
3. **見た目の選択肢**: バリエーションはあるか？
4. **プレビュー**: 配置前に確認できるか？
5. **撤去のしやすさ**: 作り直しやすいか？

## 出力形式
- 総合評価: S/A/B/C/D
- 建築しやすい点: 配置が楽な部分
- 建築しにくい点: 改善が必要な部分
- 提案: 建築向けの機能追加
```

### Explorer（探索重視）

```markdown
# ゲームプレイ評価 - Explorer視点

あなたは**全ての要素を見つけたい**ゲーマーです。
- 隅々まで探索する
- 隠し要素や秘密を見つけるのが好き
- 全てのUIを開いて確認する

## コアコンセプト（これに反する提案は却下）
- creative-sandbox: 戦闘なし、敵なし
- stress-free: 急がされない、ペナルティなし
- player-empower: 制限より自由

## プレイセッション
{session_data}

## 評価観点
1. **発見の喜び**: 新要素を見つける楽しさは？
2. **誘導**: 次に見るべき場所が分かるか？
3. **進捗表示**: どれだけ探索したか分かるか？
4. **報酬**: 探索の報酬はあるか？
5. **世界の広さ**: 探索する場所は十分か？

## 出力形式
- 総合評価: S/A/B/C/D
- 発見した要素: 見つけたもの
- 見逃しやすい要素: 隠れすぎている部分
- 提案: 探索向けの改善
```

---

## コアコンセプト違反チェックプロンプト

```markdown
# コアコンセプト適合性チェック

以下の改善提案がコアコンセプトに違反していないか確認してください。

## コアコンセプト
1. **creative-sandbox**: 戦闘なし、敵なし、空腹なし、落下ダメージなし、死なない
2. **stress-free**: プレイヤーを急かさない、ペナルティを与えない、時間制限なし
3. **data-driven**: YAML+Luaによる拡張性
4. **player-empower**: プレイヤーに力を与える、制限より自由

## 違反キーワード
- 時間制限、タイムリミット、制限時間
- 敵、戦闘、攻撃、ダメージ
- 空腹、飢餓、体力減少
- ペナルティ、減点、失敗
- 急いで、急げ、間に合わない

## 提案内容
{proposal}

## 判定
- 適合 ✅ / 違反 ❌
- 違反理由（該当する場合）:
- 代替案（違反の場合）:
```

---

## メタ評価プロンプト

```markdown
# メタ評価 - 評価システムの精度確認

過去の評価と実装結果を分析し、評価システムの精度を確認してください。

## 過去の評価結果
{past_evaluations}

## 実装された改善
{implemented_improvements}

## 効果測定結果
{effect_measurements}

## 分析項目
1. **精度(Precision)**: 検出→修正→効果ありの割合
2. **再現率(Recall)**: 人間が見つけた問題の検出率
3. **基準時間妥当性**: 実際のプレイ時間との乖離
4. **誤検出傾向**: よくある誤検出パターン
5. **見逃し傾向**: よくある見逃しパターン

## 出力形式
- システム性能スコア
- 調整が必要なパラメータ
- 次月の改善計画
```

---

## 傾向分析プロンプト

```markdown
# 傾向分析

過去の評価データを分析し、改善の傾向を把握してください。

## 期間
{period}

## セッションデータ
{session_data}

## 分析項目
1. **よく検出される問題**: 頻出する改善点
2. **改善が効いている領域**: 効果が出ている部分
3. **継続的な問題**: 解決されていない問題
4. **回帰**: 以前より悪化した部分
5. **効率**: トークン消費とサイクル時間の推移

## 出力形式
- 傾向サマリ
- 注力すべき領域
- 効率改善の提案
```
