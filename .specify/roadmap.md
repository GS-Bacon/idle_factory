# 実装ロードマップ

> **対象**: 人間（進捗確認、全体像把握）
> **AI参照**: タスク詳細は `.claude/implementation-plan.md`、設計詳細は `.claude/architecture.md`

## ドキュメント役割分担

| ファイル | 対象 | 内容 | 更新タイミング |
|----------|------|------|----------------|
| **このファイル** | 人間 | マイルストーン概要、進捗、完了条件 | マイルストーン完了時 |
| `.claude/implementation-plan.md` | AI | タスク詳細、設計コード例、完了チェック | タスク完了ごと |
| `.claude/architecture.md` | 両方 | 機能設計骨格、拡張ポイント | 設計変更時 |

---

## 現在の状態

| 項目 | 値 |
|------|-----|
| バージョン | **0.3.167** |
| コード行数 | **29,253行** |
| テスト | **613件** 通過 |
| Clippy警告 | **0件** |
| 現在地 | **M2.5** |

---

## マイルストーン概要

```
M1: Data Mod完成         ✅ 完了
        ↓
M2: Core Mod基盤         ✅ 完了 (2026-01-09)
        ↓
M2.5: バグ修正 & テスト  ← 今ここ
        ↓
M3: 電力システム         ❌ 未着手
        ↓
M4: 液体・信号           同パターンで拡張
        ↓
M5: ゲーム完成           コンテンツ充実
        ↓
M6: マルチプレイ         最後
```

---

## M1: Data Mod完成 ✅

**目標**: TOMLでアイテム・機械・レシピを追加できる

| 成果物 | 状態 |
|--------|------|
| TOML読み込み基盤 | ✅ |
| 新アイテム追加（コード変更なし） | ✅ |
| 新機械追加（既存ロジック） | ✅ |
| 新レシピ追加 | ✅ |

**遊べること**: バニラの精錬・粉砕・組立が動く

---

## M2: Core Mod基盤 ✅ (2026-01-09)

**目標**: WASMで新しいゲームロジックを追加できる

| 成果物 | 状態 |
|--------|------|
| Wasmtime統合 | ✅ |
| Mod API設計（ホスト関数） | ✅ |
| サンプルCore Mod作成 | ✅ |
| Mod間依存解決 | ✅ |
| ホットリロード（開発用） | ✅ |
| タグシステム | ✅ |
| 特殊機械Core Mod化 | ✅ |

**実装ファイル**: `src/modding/wasm/` - 8ファイル

**遊べること**: WASMでゲームロジックを拡張可能

---

## M2.5: バグ修正 & テスト強化 ← 今ここ

**目標**: M3前にUI・入力関連のバグを潰す

### 必須（M3進行条件）

| タスク | 内容 | 状態 |
|--------|------|------|
| I.1-I.5 | 入力隔離テスト（UI中のキー入力ブロック確認） | ✅ |

### 推奨

| タスク | 内容 | 状態 |
|--------|------|------|
| Q.1 | テストAPI拡張（UI要素の状態取得） | ✅ |
| T.1-T.4 | UI要素検証基盤（動的ID対応） | ✅ |

### 任意

| タスク | 内容 | 状態 |
|--------|------|------|
| U.1-U.5 | UIプレビューモード | ❌ |
| B.1-B.3 | バグ修正（UI表示系） | ❌ |
| R.1-R.5 | ブロックテクスチャ | ✅ |

**完了条件**:
- [x] 入力隔離テスト（I.1-I.5）が全てパス
- [x] `cargo test && cargo clippy` がパス

---

## M3: 電力システム

**目標**: 発電機→電線→機械の電力供給

| タスク | 内容 |
|--------|------|
| P.1 | 電力グリッド計算 |
| P.2 | 発電機（水車、石炭発電） |
| P.3 | 電線ブロック |
| P.4 | 電力消費機械（電動採掘機等） |
| P.5 | 電力UI（HUD、機械UI） |

**完了条件**:
- [ ] 発電機が燃料消費して電力生成
- [ ] 電線で電力が伝播
- [ ] 電力不足で機械停止
- [ ] 電力状況がUIで確認できる

**遊べること**: 電力管理が必要なファクトリーゲーム

---

## M4: 液体・信号

**目標**: パイプで液体、ワイヤーで信号を流す

| タスク | 内容 |
|--------|------|
| F.1-F.3 | 液体スロット・パイプ・ポンプ |
| S.1-S.3 | 信号ワイヤー・センサー・論理ゲート |

**遊べること**: 複雑な自動化、条件分岐

---

## M5: ゲーム完成

**目標**: 製品版として遊べる状態

| カテゴリ | 内容 |
|----------|------|
| コンテンツ | 機械50種類、レシピ100種類、クエスト30以上 |
| UI/UX | マップ、ブループリント、統計 |
| 演出 | サウンド、実績 |

**遊べること**: 10時間以上遊べるファクトリーゲーム

---

## M6: マルチプレイ

**目標**: 複数プレイヤーで協力プレイ

**前提条件（完了済み）**: PlayerInventory Component化、LocalPlayer Entity化、NetworkId定義

| タスク | 内容 |
|--------|------|
| N.1 | P2P接続（WebRTC） |
| N.2 | 状態同期 |
| N.3 | 権限管理 |
| N.4 | ロビー・招待 |

**遊べること**: フレンドと一緒に工場建設

---

## 依存関係図

```
                    M1: Data Mod ✅
                         │
                         ▼
                    M2: Core Mod (WASM) ✅
                         │
                         ▼
                    M2.5: バグ修正 ← 今ここ
                         │
         ┌───────────────┼───────────────┐
         ▼               ▼               ▼
    M3: 電力        M4: 液体         M4: 信号
         │               │               │
         └───────────────┴───────────────┘
                         │
                         ▼
                   M5: ゲーム完成
                         │
                         ▼
                   M6: マルチプレイ
```

---

## 完了済みPhase（参考）

| Phase | 内容 | 完了日 |
|-------|------|--------|
| A | v0.2完成（チュートリアル、バイオームUI） | - |
| B | アーキテクチャ再設計 | - |
| C | データ駆動設計 | 2026-01-07 |
| D.0-D.14 | 基盤強化 | 2026-01-08 |
| M2 | Core Mod基盤 | 2026-01-09 |

---

*最終更新: 2026-01-11*
