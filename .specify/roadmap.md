# 実装ロードマップ

> 詳細な設計は `.claude/architecture-future.md` 参照
> タスク詳細は `.claude/implementation-plan.md` 参照

## 現在の状態

| 項目 | 値 |
|------|-----|
| バージョン | **0.3.136** |
| コード行数 | **29,253行** |
| テスト | **613件** 通過 |
| Clippy警告 | **0件** |

---

## マイルストーン概要

```
M1: Data Mod完成         ✅ 完了
        ↓
M2: Core Mod基盤         ✅ 完了 (2026-01-09)
        ↓
M3: 電力システム         ← 今ここ
        ↓
M4: 液体・信号           同パターンで拡張
        ↓
M5: ゲーム完成           コンテンツ充実
        ↓
M6: マルチプレイ         最後
```

---

## M1: Data Mod完成 ✅

**目標**: TOMLでアイテム・機械・レシピを追加できる

| 成果物 | 状態 |
|--------|------|
| TOML読み込み基盤 | ✅ 完了 |
| 新アイテム追加（コード変更なし） | ✅ 完了 |
| 新機械追加（既存ロジック） | ✅ 完了 |
| 新レシピ追加 | ✅ 完了 |

**遊べること**: バニラの精錬・粉砕・組立が動く

---

## M2: Core Mod基盤 ✅ 完了 (2026-01-09)

**目標**: WASMで新しいゲームロジックを追加できる

### 成果物

| タスク | 内容 | 状態 |
|--------|------|------|
| W.1 | Wasmtime統合 | ✅ 完了 |
| W.2 | Mod API設計（ホスト関数） | ✅ 完了 |
| W.3 | サンプルCore Mod作成 | ✅ 完了 |
| W.4 | Mod間依存解決 | ✅ 完了 |
| W.5 | ホットリロード（開発用） | ✅ 完了 |
| W.6 | タグシステム | ✅ 完了 |
| W.7 | 特殊機械Core Mod化 | ✅ 完了 |

### 実装ファイル

- `src/modding/wasm/` - 8ファイル
- ホスト関数: 読み取り/書き込み/イベント/ログAPI

### 完了条件

- [x] `cargo build -p sample_mod --target wasm32-unknown-unknown` が通る
- [x] ゲーム起動時にWASM Modがロードされる
- [x] Mod内から機械状態を読み書きできる

**遊べること**: WASMでゲームロジックを拡張可能

---

## M3: 電力システム ← 今ここ

**目標**: 発電機→電線→機械の電力供給

### 成果物（Core Modとして実装）

| タスク | 内容 | 状態 |
|--------|------|------|
| P.1 | 電力グリッド計算 | ❌ 未着手 |
| P.2 | 発電機（水車、石炭発電） | ❌ 未着手 |
| P.3 | 電線ブロック | ❌ 未着手 |
| P.4 | 電力消費機械（電動採掘機等） | ❌ 未着手 |
| P.5 | 電力UI（HUD、機械UI） | ❌ 未着手 |

### 完了条件

- [ ] 発電機が燃料消費して電力生成
- [ ] 電線で電力が伝播
- [ ] 電力不足で機械停止
- [ ] 電力状況がUIで確認できる

**遊べること**: 電力管理が必要なファクトリーゲーム

---

## M4: 液体・信号

**目標**: パイプで液体、ワイヤーで信号を流す

### 成果物

| タスク | 内容 | 状態 |
|--------|------|------|
| F.1 | 液体スロット・パイプ | ❌ 未着手 |
| F.2 | ポンプ・タンク | ❌ 未着手 |
| F.3 | 液体レシピ（精錬に水等） | ❌ 未着手 |
| S.1 | 信号ワイヤー | ❌ 未着手 |
| S.2 | センサー（在庫検知等） | ❌ 未着手 |
| S.3 | 論理ゲート（AND/OR/NOT） | ❌ 未着手 |

**遊べること**: 複雑な自動化、条件分岐

---

## M5: ゲーム完成

**目標**: 製品版として遊べる状態

### 成果物

| カテゴリ | 内容 | 状態 |
|----------|------|------|
| コンテンツ | 機械50種類以上 | ❌ |
| コンテンツ | レシピ100種類以上 | ❌ |
| コンテンツ | クエスト30以上 | ❌ |
| UI/UX | マップ機能 | ❌ |
| UI/UX | ブループリント | ❌ |
| UI/UX | 統計・分析 | ❌ |
| 演出 | サウンド | ❌ |
| 演出 | 実績システム | ❌ |

**遊べること**: 10時間以上遊べるファクトリーゲーム

---

## M6: マルチプレイ

**目標**: 複数プレイヤーで協力プレイ

### 前提条件（完了済み）

- ✅ PlayerInventory Component化
- ✅ LocalPlayer Entity化
- ✅ NetworkId定義
- ✅ イベントシステム

### 成果物

| タスク | 内容 | 状態 |
|--------|------|------|
| N.1 | P2P接続（WebRTC） | ❌ 未着手 |
| N.2 | 状態同期 | ❌ 未着手 |
| N.3 | 権限管理 | ❌ 未着手 |
| N.4 | ロビー・招待 | ❌ 未着手 |

**遊べること**: フレンドと一緒に工場建設

---

## 完了済みPhase（参考）

| Phase | 内容 | 完了日 |
|-------|------|--------|
| A | v0.2完成（チュートリアル、バイオームUI） | - |
| B | アーキテクチャ再設計（物流分離、機械統合） | - |
| C | データ駆動設計（BlockDescriptor, GameRegistry） | 2026-01-07 |
| D.0-D.14 | 基盤強化（イベント、動的ID、Plugin化） | 2026-01-08 |
| M2 | Core Mod基盤（WASM対応） | 2026-01-09 |

---

## 依存関係図

```
                    M1: Data Mod ✅
                         │
                         ▼
                    M2: Core Mod (WASM) ✅
                         │
         ┌───────────────┼───────────────┐
         ▼               ▼               ▼
    M3: 電力 ←      M4: 液体         M4: 信号
         │               │               │
         └───────────────┴───────────────┘
                         │
                         ▼
                   M5: ゲーム完成
                         │
                         ▼
                   M6: マルチプレイ
```

---

*最終更新: 2026-01-09*
